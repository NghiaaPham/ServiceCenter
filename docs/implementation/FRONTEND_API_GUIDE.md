# üì± H∆Ø·ªöNG D·∫™N T√çCH H·ª¢P API - FRONTEND GUIDE

## üéØ T·ªïng quan
T√†i li·ªáu n√†y h∆∞·ªõng d·∫´n chi ti·∫øt c√°c API endpoints v√† lu·ªìng x·ª≠ l√Ω ƒë·ªÉ frontend t√≠ch h·ª£p v·ªõi EV Service Center Backend.

**Base URL**: `http://localhost:5153/api`
**Swagger UI**: `http://localhost:5153/swagger`

---

## üìã M·ª§C L·ª§C

1. [Authentication Flow](#1-authentication-flow)
2. [Customer Profile Management](#2-customer-profile-management)
3. [Vehicle Management](#3-vehicle-management)
4. [View Available Services & Packages](#4-view-available-services--packages)
5. [Package Subscription Purchase](#5-package-subscription-purchase)
6. [Smart Appointment Booking](#6-smart-appointment-booking)
7. [View My Appointments](#7-view-my-appointments)
8. [Error Handling](#8-error-handling)

---

## 1. AUTHENTICATION FLOW

### 1.1. ƒêƒÉng k√Ω t√†i kho·∫£n m·ªõi (Customer Registration)

**Endpoint**: `POST /api/customer-registration/register`

**Request Body**:
```json
{
  "email": "customer@example.com",
  "password": "Password123!",
  "confirmPassword": "Password123!",
  "fullName": "Nguy·ªÖn VƒÉn A",
  "phoneNumber": "0901234567",
  "address": "123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, TP.HCM",
  "dateOfBirth": "1990-01-15"
}
```

**Response Success (201)**:
```json
{
  "success": true,
  "message": "ƒêƒÉng k√Ω th√†nh c√¥ng. Vui l√≤ng ki·ªÉm tra email ƒë·ªÉ x√°c th·ª±c t√†i kho·∫£n.",
  "data": {
    "userId": 123,
    "customerId": 456,
    "email": "customer@example.com",
    "fullName": "Nguy·ªÖn VƒÉn A",
    "verificationRequired": true
  }
}
```

**Response Error (400)**:
```json
{
  "success": false,
  "message": "Email ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng",
  "errors": ["Email n√†y ƒë√£ t·ªìn t·∫°i trong h·ªá th·ªëng"]
}
```

---

### 1.2. X√°c th·ª±c Email

**Endpoint**: `POST /api/verification/verify-email`

**Request Body**:
```json
{
  "email": "customer@example.com",
  "token": "ABC123XYZ789"
}
```

**Response Success (200)**:
```json
{
  "success": true,
  "message": "X√°c th·ª±c email th√†nh c√¥ng"
}
```

---

### 1.3. ƒêƒÉng nh·∫≠p (Login)

**Endpoint**: `POST /api/auth/login`

**Request Body**:
```json
{
  "email": "customer@example.com",
  "password": "Password123!"
}
```

**Response Success (200)**:
```json
{
  "success": true,
  "message": "ƒêƒÉng nh·∫≠p th√†nh c√¥ng",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "def50200abc...",
    "expiresIn": 3600,
    "user": {
      "userId": 123,
      "email": "customer@example.com",
      "fullName": "Nguy·ªÖn VƒÉn A",
      "role": "Customer",
      "customerId": 456
    }
  }
}
```

**L∆∞u token v√†o localStorage/sessionStorage**:
```javascript
// Frontend code example
localStorage.setItem('accessToken', response.data.token);
localStorage.setItem('refreshToken', response.data.refreshToken);
localStorage.setItem('user', JSON.stringify(response.data.user));
```

**Response Error (401)**:
```json
{
  "success": false,
  "message": "Email ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ch√≠nh x√°c"
}
```

---

### 1.4. Th√™m Authorization Header v√†o m·ªçi request

Sau khi ƒëƒÉng nh·∫≠p th√†nh c√¥ng, **M·ªåI REQUEST** ti·∫øp theo c·∫ßn c√≥ header:

```javascript
headers: {
  'Authorization': `Bearer ${localStorage.getItem('accessToken')}`,
  'Content-Type': 'application/json'
}
```

**Example v·ªõi Axios**:
```javascript
const api = axios.create({
  baseURL: 'http://localhost:5153/api',
});

// Interceptor ƒë·ªÉ t·ª± ƒë·ªông th√™m token
api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('accessToken');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);
```

---

## 2. CUSTOMER PROFILE MANAGEMENT

### 2.1. Xem th√¥ng tin c√° nh√¢n

**Endpoint**: `GET /api/customer/profile/me`
**Auth**: Required

**Response Success (200)**:
```json
{
  "success": true,
  "data": {
    "customerId": 456,
    "userId": 123,
    "fullName": "Nguy·ªÖn VƒÉn A",
    "email": "customer@example.com",
    "phoneNumber": "0901234567",
    "address": "123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, TP.HCM",
    "dateOfBirth": "1990-01-15",
    "loyaltyPoints": 1500,
    "totalSpent": 5000000,
    "customerType": {
      "typeId": 1,
      "typeName": "VIP",
      "discountPercent": 10
    }
  }
}
```

---

### 2.2. C·∫≠p nh·∫≠t th√¥ng tin c√° nh√¢n

**Endpoint**: `PUT /api/customer/profile/me`
**Auth**: Required

**Request Body**:
```json
{
  "fullName": "Nguy·ªÖn VƒÉn B",
  "phoneNumber": "0907654321",
  "address": "456 ƒê∆∞·ªùng XYZ, Qu·∫≠n 2, TP.HCM"
}
```

**Response Success (200)**:
```json
{
  "success": true,
  "message": "C·∫≠p nh·∫≠t th√¥ng tin th√†nh c√¥ng",
  "data": {
    "customerId": 456,
    "fullName": "Nguy·ªÖn VƒÉn B",
    "phoneNumber": "0907654321",
    "address": "456 ƒê∆∞·ªùng XYZ, Qu·∫≠n 2, TP.HCM"
  }
}
```

---

## 3. VEHICLE MANAGEMENT

### 3.1. Xem danh s√°ch xe c·ªßa t√¥i

**Endpoint**: `GET /api/customer/profile/my-vehicles`
**Auth**: Required

**Response Success (200)**:
```json
{
  "success": true,
  "data": [
    {
      "vehicleId": 1,
      "licensePlate": "51A-12345",
      "carModel": {
        "modelId": 5,
        "modelName": "VinFast VF8",
        "brandName": "VinFast"
      },
      "year": 2023,
      "color": "ƒê·ªè",
      "mileage": 15000,
      "batteryHealthPercent": 95.5,
      "lastMaintenanceDate": "2024-09-01",
      "nextMaintenanceDue": "2025-03-01"
    },
    {
      "vehicleId": 2,
      "licensePlate": "51B-67890",
      "carModel": {
        "modelId": 3,
        "modelName": "Tesla Model 3",
        "brandName": "Tesla"
      },
      "year": 2022,
      "color": "Tr·∫Øng",
      "mileage": 25000,
      "batteryHealthPercent": 92.0,
      "lastMaintenanceDate": "2024-08-15",
      "nextMaintenanceDue": "2025-02-15"
    }
  ]
}
```

---

### 3.2. Th√™m xe m·ªõi

**Endpoint**: `POST /api/customer/profile/my-vehicles`
**Auth**: Required

**Request Body**:
```json
{
  "licensePlate": "51C-99999",
  "modelId": 5,
  "year": 2024,
  "color": "Xanh",
  "vinNumber": "VF1234567890ABCDE",
  "purchaseDate": "2024-01-15",
  "mileage": 0
}
```

**Response Success (201)**:
```json
{
  "success": true,
  "message": "Th√™m xe th√†nh c√¥ng",
  "data": {
    "vehicleId": 3,
    "licensePlate": "51C-99999",
    "carModel": {
      "modelId": 5,
      "modelName": "VinFast VF8",
      "brandName": "VinFast"
    },
    "year": 2024,
    "color": "Xanh",
    "mileage": 0
  }
}
```

---

## 4. VIEW AVAILABLE SERVICES & PACKAGES

### 4.1. Xem danh s√°ch d·ªãch v·ª•

**Endpoint**: `GET /api/maintenance-services`
**Auth**: Not required (public)

**Query Parameters**:
- `categoryId` (optional): Filter by category
- `isActive` (optional): true/false
- `searchTerm` (optional): Search by name

**Response Success (200)**:
```json
{
  "success": true,
  "data": [
    {
      "serviceId": 1,
      "serviceName": "Thay l·ªëp xe ƒëi·ªán",
      "categoryName": "B·∫£o d∆∞·ª°ng ƒë·ªãnh k·ª≥",
      "description": "Thay 4 l·ªëp xe ƒëi·ªán ch√≠nh h√£ng",
      "basePrice": 2000000,
      "estimatedDuration": 60,
      "isWarrantyService": false
    },
    {
      "serviceId": 2,
      "serviceName": "Ki·ªÉm tra pin",
      "categoryName": "Ki·ªÉm tra ch·∫©n ƒëo√°n",
      "description": "Ki·ªÉm tra t√¨nh tr·∫°ng pin, BMS v√† s·ª©c kh·ªèe pin",
      "basePrice": 500000,
      "estimatedDuration": 30,
      "isWarrantyService": true
    }
  ]
}
```

---

### 4.2. Xem gi√° d·ªãch v·ª• theo xe

**Endpoint**: `GET /api/model-service-pricing/model/{modelId}/services`
**Auth**: Not required (public)

**Response Success (200)**:
```json
{
  "success": true,
  "data": [
    {
      "pricingId": 10,
      "serviceId": 1,
      "serviceName": "Thay l·ªëp xe ƒëi·ªán",
      "modelId": 5,
      "modelName": "VinFast VF8",
      "price": 2200000,
      "estimatedDuration": 60
    },
    {
      "pricingId": 11,
      "serviceId": 2,
      "serviceName": "Ki·ªÉm tra pin",
      "modelId": 5,
      "modelName": "VinFast VF8",
      "price": 450000,
      "estimatedDuration": 30
    }
  ]
}
```

---

### 4.3. Xem danh s√°ch g√≥i b·∫£o d∆∞·ª°ng (Maintenance Packages)

**Endpoint**: `GET /api/maintenance-packages`
**Auth**: Not required (public)

**Response Success (200)**:
```json
{
  "success": true,
  "data": [
    {
      "packageId": 1,
      "packageName": "G√≥i B·∫£o D∆∞·ª°ng C∆° B·∫£n",
      "description": "3 l·∫ßn b·∫£o d∆∞·ª°ng ƒë·ªãnh k·ª≥ trong 6 th√°ng",
      "totalServices": 3,
      "validityPeriod": 180,
      "price": 3000000,
      "discountPercent": 10,
      "isActive": true,
      "services": [
        {
          "serviceId": 2,
          "serviceName": "Ki·ªÉm tra pin",
          "quantity": 3
        },
        {
          "serviceId": 5,
          "serviceName": "Thay d·∫ßu phanh",
          "quantity": 3
        }
      ]
    },
    {
      "packageId": 2,
      "packageName": "G√≥i B·∫£o D∆∞·ª°ng VIP",
      "description": "6 l·∫ßn b·∫£o d∆∞·ª°ng cao c·∫•p trong 1 nƒÉm",
      "totalServices": 6,
      "validityPeriod": 365,
      "price": 8000000,
      "discountPercent": 20,
      "isActive": true,
      "services": [
        {
          "serviceId": 1,
          "serviceName": "Thay l·ªëp xe ƒëi·ªán",
          "quantity": 1
        },
        {
          "serviceId": 2,
          "serviceName": "Ki·ªÉm tra pin",
          "quantity": 6
        }
      ]
    }
  ]
}
```

---

## 5. PACKAGE SUBSCRIPTION PURCHASE

### 5.1. Xem g√≥i ƒëƒÉng k√Ω c·ªßa t√¥i

**Endpoint**: `GET /api/package-subscriptions/my-subscriptions`
**Auth**: Required

**Query Parameters**:
- `statusFilter` (optional): Active | Expired | Cancelled

**Response Success (200)**:
```json
{
  "success": true,
  "data": [
    {
      "subscriptionId": 10,
      "packageId": 2,
      "packageName": "G√≥i B·∫£o D∆∞·ª°ng VIP",
      "vehicleId": 1,
      "vehiclePlate": "51A-12345",
      "startDate": "2024-01-01",
      "endDate": "2025-01-01",
      "totalServices": 6,
      "usedServices": 2,
      "remainingServices": 4,
      "status": "Active",
      "purchasePrice": 8000000,
      "discountPercent": 20
    }
  ]
}
```

---

### 5.2. Xem chi ti·∫øt usage c·ªßa subscription

**Endpoint**: `GET /api/package-subscriptions/{subscriptionId}/usage`
**Auth**: Required

**Response Success (200)**:
```json
{
  "success": true,
  "data": {
    "subscriptionId": 10,
    "packageName": "G√≥i B·∫£o D∆∞·ª°ng VIP",
    "totalServices": 6,
    "usedServices": 2,
    "remainingServices": 4,
    "usageHistory": [
      {
        "usageId": 1,
        "appointmentId": 100,
        "serviceName": "Ki·ªÉm tra pin",
        "usedDate": "2024-02-15",
        "quantityUsed": 1
      },
      {
        "usageId": 2,
        "appointmentId": 105,
        "serviceName": "Ki·ªÉm tra pin",
        "usedDate": "2024-05-20",
        "quantityUsed": 1
      }
    ]
  }
}
```

---

### 5.3. Mua g√≥i ƒëƒÉng k√Ω m·ªõi

**Endpoint**: `POST /api/package-subscriptions/purchase`
**Auth**: Required

**Request Body**:
```json
{
  "packageId": 2,
  "vehicleId": 1,
  "paymentMethodId": 1,
  "autoRenew": false
}
```

**Response Success (201)**:
```json
{
  "success": true,
  "message": "Mua g√≥i ƒëƒÉng k√Ω th√†nh c√¥ng",
  "data": {
    "subscriptionId": 15,
    "packageName": "G√≥i B·∫£o D∆∞·ª°ng VIP",
    "startDate": "2024-10-10",
    "endDate": "2025-10-10",
    "totalServices": 6,
    "remainingServices": 6,
    "status": "Active",
    "paymentRequired": true,
    "paymentAmount": 8000000,
    "paymentUrl": "https://payment-gateway.com/pay?token=xyz123"
  }
}
```

---

## 6. SMART APPOINTMENT BOOKING

### 6.1. Xem th·ªùi gian tr·ªëng (Available Time Slots)

**Endpoint**: `GET /api/timeslots/available`
**Auth**: Not required (public)

**Query Parameters**:
- `date` (required): 2024-10-15
- `serviceCenterId` (optional): 1
- `duration` (optional): 60

**Response Success (200)**:
```json
{
  "success": true,
  "data": {
    "date": "2024-10-15",
    "availableSlots": [
      {
        "slotId": 1,
        "startTime": "08:00",
        "endTime": "09:00",
        "available": true,
        "remainingCapacity": 3
      },
      {
        "slotId": 2,
        "startTime": "09:00",
        "endTime": "10:00",
        "available": true,
        "remainingCapacity": 2
      },
      {
        "slotId": 3,
        "startTime": "10:00",
        "endTime": "11:00",
        "available": false,
        "remainingCapacity": 0
      }
    ]
  }
}
```

---

### 6.2. T·∫°o Appointment (Smart Subscription Auto-Apply)

**Endpoint**: `POST /api/appointments`
**Auth**: Required

**Request Body**:
```json
{
  "serviceCenterId": 1,
  "vehicleId": 1,
  "appointmentDate": "2024-10-15",
  "slotId": 1,
  "services": [
    {
      "serviceId": 2,
      "quantity": 1,
      "notes": "Ki·ªÉm tra k·ªπ pin tr∆∞·ªõc khi ƒëi xa"
    }
  ],
  "notes": "T√¥i s·∫Ω ƒë·∫øn ƒë√∫ng gi·ªù",
  "preferredTechnicianId": null
}
```

**Response Success - V·ªõi Subscription (201)**:
```json
{
  "success": true,
  "message": "ƒê·∫∑t l·ªãch th√†nh c√¥ng. D·ªãch v·ª• ƒë∆∞·ª£c √°p d·ª•ng t·ª´ g√≥i ƒëƒÉng k√Ω.",
  "data": {
    "appointmentId": 200,
    "appointmentCode": "APT-2024-200",
    "status": "Pending",
    "appointmentDate": "2024-10-15",
    "slotTime": "08:00 - 09:00",
    "serviceCenter": {
      "centerId": 1,
      "centerName": "EV Service Center - Qu·∫≠n 1"
    },
    "vehicle": {
      "vehicleId": 1,
      "licensePlate": "51A-12345",
      "modelName": "VinFast VF8"
    },
    "services": [
      {
        "appointmentServiceId": 500,
        "serviceId": 2,
        "serviceName": "Ki·ªÉm tra pin",
        "serviceSource": "Subscription",
        "subscriptionId": 10,
        "price": 0,
        "estimatedDuration": 30
      }
    ],
    "totalAmount": 0,
    "subscriptionApplied": true,
    "subscriptionDetails": {
      "subscriptionId": 10,
      "packageName": "G√≥i B·∫£o D∆∞·ª°ng VIP",
      "remainingServicesAfter": 3
    }
  }
}
```

**Response Success - Kh√¥ng c√≥ Subscription (201)**:
```json
{
  "success": true,
  "message": "ƒê·∫∑t l·ªãch th√†nh c√¥ng. B·∫°n c·∫ßn thanh to√°n khi ƒë·∫øn.",
  "data": {
    "appointmentId": 201,
    "appointmentCode": "APT-2024-201",
    "status": "Pending",
    "appointmentDate": "2024-10-15",
    "slotTime": "09:00 - 10:00",
    "serviceCenter": {
      "centerId": 1,
      "centerName": "EV Service Center - Qu·∫≠n 1"
    },
    "vehicle": {
      "vehicleId": 2,
      "licensePlate": "51B-67890",
      "modelName": "Tesla Model 3"
    },
    "services": [
      {
        "appointmentServiceId": 501,
        "serviceId": 1,
        "serviceName": "Thay l·ªëp xe ƒëi·ªán",
        "serviceSource": "Extra",
        "subscriptionId": null,
        "price": 2000000,
        "estimatedDuration": 60
      }
    ],
    "totalAmount": 2000000,
    "subscriptionApplied": false,
    "paymentRequired": true
  }
}
```

**Response Error - Kh√¥ng ƒë·ªß d·ªãch v·ª• trong g√≥i (400)**:
```json
{
  "success": false,
  "message": "G√≥i ƒëƒÉng k√Ω kh√¥ng ƒë·ªß s·ªë l∆∞·ª£ng d·ªãch v·ª•",
  "data": {
    "availableInSubscription": 1,
    "requested": 2,
    "suggestionMessage": "B·∫°n c√≥ 1 d·ªãch v·ª• trong g√≥i. D·ªãch v·ª• c√≤n l·∫°i s·∫Ω t√≠nh ph√≠ 500,000 VNƒê."
  }
}
```

---

### 6.3. Flow x·ª≠ l√Ω Smart Subscription trong Frontend

```javascript
// Example Frontend Logic
async function createAppointment(appointmentData) {
  try {
    // 1. G·ªçi API t·∫°o appointment
    const response = await api.post('/api/appointments', appointmentData);

    // 2. Ki·ªÉm tra c√≥ subscription ƒë∆∞·ª£c apply kh√¥ng
    if (response.data.subscriptionApplied) {
      // Tr∆∞·ªùng h·ª£p: D·ªãch v·ª• ƒë∆∞·ª£c tr·ª´ t·ª´ g√≥i
      showSuccessMessage(
        `ƒê·∫∑t l·ªãch th√†nh c√¥ng! D·ªãch v·ª• ƒë∆∞·ª£c √°p d·ª•ng t·ª´ ${response.data.subscriptionDetails.packageName}. ` +
        `C√≤n l·∫°i ${response.data.subscriptionDetails.remainingServicesAfter} d·ªãch v·ª•.`
      );

      // Kh√¥ng c·∫ßn thanh to√°n
      redirectTo(`/appointments/${response.data.appointmentId}`);

    } else {
      // Tr∆∞·ªùng h·ª£p: C·∫ßn thanh to√°n
      showSuccessMessage(
        `ƒê·∫∑t l·ªãch th√†nh c√¥ng! Vui l√≤ng thanh to√°n ${formatCurrency(response.data.totalAmount)} VNƒê khi ƒë·∫øn.`
      );

      // Hi·ªÉn th·ªã th√¥ng tin thanh to√°n
      if (response.data.paymentRequired) {
        showPaymentOptions(response.data);
      }

      redirectTo(`/appointments/${response.data.appointmentId}`);
    }

  } catch (error) {
    // X·ª≠ l√Ω l·ªói
    if (error.response?.status === 400) {
      showErrorMessage(error.response.data.message);
    } else {
      showErrorMessage('ƒê·∫∑t l·ªãch th·∫•t b·∫°i. Vui l√≤ng th·ª≠ l·∫°i.');
    }
  }
}
```

---

## 7. VIEW MY APPOINTMENTS

### 7.1. Xem danh s√°ch l·ªãch h·∫πn c·ªßa t√¥i

**Endpoint**: `GET /api/appointments/my-appointments`
**Auth**: Required

**Query Parameters**:
- `status` (optional): Pending | Confirmed | Completed | Cancelled
- `fromDate` (optional): 2024-01-01
- `toDate` (optional): 2024-12-31

**Response Success (200)**:
```json
{
  "success": true,
  "data": [
    {
      "appointmentId": 200,
      "appointmentCode": "APT-2024-200",
      "status": "Confirmed",
      "appointmentDate": "2024-10-15",
      "slotTime": "08:00 - 09:00",
      "serviceCenter": {
        "centerId": 1,
        "centerName": "EV Service Center - Qu·∫≠n 1",
        "address": "123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1",
        "phoneNumber": "028-1234-5678"
      },
      "vehicle": {
        "vehicleId": 1,
        "licensePlate": "51A-12345",
        "modelName": "VinFast VF8"
      },
      "services": [
        {
          "serviceName": "Ki·ªÉm tra pin",
          "serviceSource": "Subscription",
          "price": 0
        }
      ],
      "totalAmount": 0,
      "subscriptionUsed": true,
      "createdDate": "2024-10-01T10:30:00"
    },
    {
      "appointmentId": 201,
      "appointmentCode": "APT-2024-201",
      "status": "Pending",
      "appointmentDate": "2024-10-20",
      "slotTime": "14:00 - 16:00",
      "serviceCenter": {
        "centerId": 1,
        "centerName": "EV Service Center - Qu·∫≠n 1",
        "address": "123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1",
        "phoneNumber": "028-1234-5678"
      },
      "vehicle": {
        "vehicleId": 2,
        "licensePlate": "51B-67890",
        "modelName": "Tesla Model 3"
      },
      "services": [
        {
          "serviceName": "Thay l·ªëp xe ƒëi·ªán",
          "serviceSource": "Extra",
          "price": 2000000
        }
      ],
      "totalAmount": 2000000,
      "subscriptionUsed": false,
      "paymentStatus": "Unpaid",
      "createdDate": "2024-10-05T15:45:00"
    }
  ]
}
```

---

### 7.2. Xem chi ti·∫øt l·ªãch h·∫πn

**Endpoint**: `GET /api/appointments/{appointmentId}`
**Auth**: Required

**Response Success (200)**:
```json
{
  "success": true,
  "data": {
    "appointmentId": 200,
    "appointmentCode": "APT-2024-200",
    "status": "Confirmed",
    "appointmentDate": "2024-10-15",
    "slotTime": "08:00 - 09:00",
    "estimatedCompletionTime": "09:00",
    "serviceCenter": {
      "centerId": 1,
      "centerName": "EV Service Center - Qu·∫≠n 1",
      "address": "123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, TP.HCM",
      "phoneNumber": "028-1234-5678",
      "email": "q1@evservicecenter.com"
    },
    "customer": {
      "customerId": 456,
      "fullName": "Nguy·ªÖn VƒÉn A",
      "phoneNumber": "0901234567",
      "email": "customer@example.com"
    },
    "vehicle": {
      "vehicleId": 1,
      "licensePlate": "51A-12345",
      "modelName": "VinFast VF8",
      "brandName": "VinFast",
      "year": 2023,
      "color": "ƒê·ªè",
      "mileage": 15000
    },
    "services": [
      {
        "appointmentServiceId": 500,
        "serviceId": 2,
        "serviceName": "Ki·ªÉm tra pin",
        "serviceSource": "Subscription",
        "subscriptionId": 10,
        "price": 0,
        "originalPrice": 450000,
        "estimatedDuration": 30,
        "technician": null,
        "status": "Pending"
      }
    ],
    "subscriptionInfo": {
      "subscriptionId": 10,
      "packageName": "G√≥i B·∫£o D∆∞·ª°ng VIP",
      "remainingServices": 3
    },
    "totalAmount": 0,
    "paidAmount": 0,
    "remainingAmount": 0,
    "notes": "T√¥i s·∫Ω ƒë·∫øn ƒë√∫ng gi·ªù",
    "createdDate": "2024-10-01T10:30:00",
    "updatedDate": "2024-10-02T09:15:00"
  }
}
```

---

### 7.3. H·ªßy l·ªãch h·∫πn

**Endpoint**: `POST /api/appointments/{appointmentId}/cancel`
**Auth**: Required

**Request Body**:
```json
{
  "reason": "T√¥i c√≥ vi·ªác ƒë·ªôt xu·∫•t, xin l·ªói"
}
```

**Response Success (200)**:
```json
{
  "success": true,
  "message": "H·ªßy l·ªãch h·∫πn th√†nh c√¥ng",
  "data": {
    "appointmentId": 200,
    "status": "Cancelled",
    "subscriptionRestored": true,
    "restoredServices": 1,
    "message": "D·ªãch v·ª• ƒë√£ ƒë∆∞·ª£c ho√†n tr·∫£ v√†o g√≥i ƒëƒÉng k√Ω c·ªßa b·∫°n"
  }
}
```

---

## 8. ERROR HANDLING

### 8.1. Error Response Format

M·ªçi l·ªói ƒë·ªÅu tr·∫£ v·ªÅ format chu·∫©n:

```json
{
  "success": false,
  "message": "M√¥ t·∫£ l·ªói ch√≠nh",
  "errors": [
    "Chi ti·∫øt l·ªói 1",
    "Chi ti·∫øt l·ªói 2"
  ],
  "statusCode": 400
}
```

---

### 8.2. Common HTTP Status Codes

| Status Code | √ù nghƒ©a | X·ª≠ l√Ω Frontend |
|-------------|---------|----------------|
| 200 | Success | Hi·ªÉn th·ªã k·∫øt qu·∫£ |
| 201 | Created | Redirect ho·∫∑c hi·ªÉn th·ªã success |
| 400 | Bad Request | Hi·ªÉn th·ªã l·ªói validation |
| 401 | Unauthorized | Redirect ƒë·∫øn login, clear token |
| 403 | Forbidden | Hi·ªÉn th·ªã "B·∫°n kh√¥ng c√≥ quy·ªÅn" |
| 404 | Not Found | Hi·ªÉn th·ªã "Kh√¥ng t√¨m th·∫•y" |
| 409 | Conflict | Hi·ªÉn th·ªã l·ªói xung ƒë·ªôt (v√≠ d·ª•: email ƒë√£ t·ªìn t·∫°i) |
| 500 | Server Error | Hi·ªÉn th·ªã "L·ªói h·ªá th·ªëng, vui l√≤ng th·ª≠ l·∫°i" |

---

### 8.3. Example Error Handler (Axios)

```javascript
// Axios interceptor ƒë·ªÉ x·ª≠ l√Ω l·ªói t·∫≠p trung
api.interceptors.response.use(
  (response) => response,
  (error) => {
    const { status, data } = error.response || {};

    switch (status) {
      case 401:
        // Token h·∫øt h·∫°n ho·∫∑c kh√¥ng h·ª£p l·ªá
        localStorage.removeItem('accessToken');
        localStorage.removeItem('user');
        window.location.href = '/login';
        break;

      case 403:
        showErrorMessage('B·∫°n kh√¥ng c√≥ quy·ªÅn th·ª±c hi·ªán thao t√°c n√†y');
        break;

      case 404:
        showErrorMessage('Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu');
        break;

      case 400:
        // Validation errors
        if (data.errors && Array.isArray(data.errors)) {
          showErrorMessage(data.errors.join('\n'));
        } else {
          showErrorMessage(data.message || 'D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá');
        }
        break;

      case 500:
      default:
        showErrorMessage('L·ªói h·ªá th·ªëng. Vui l√≤ng th·ª≠ l·∫°i sau.');
        break;
    }

    return Promise.reject(error);
  }
);
```

---

## 9. COMPLETE FLOW DIAGRAM

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    CUSTOMER JOURNEY FLOW                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

1. ƒêƒÇNG K√ù / ƒêƒÇNG NH·∫¨P
   ‚îú‚îÄ‚Üí POST /api/customer-registration/register
   ‚îú‚îÄ‚Üí POST /api/verification/verify-email
   ‚îî‚îÄ‚Üí POST /api/auth/login ‚Üí Nh·∫≠n JWT Token

2. XEM PROFILE & VEHICLES
   ‚îú‚îÄ‚Üí GET /api/customer/profile/me
   ‚îú‚îÄ‚Üí GET /api/customer/profile/my-vehicles
   ‚îî‚îÄ‚Üí POST /api/customer/profile/my-vehicles (Th√™m xe m·ªõi)

3. XEM SUBSCRIPTIONS
   ‚îú‚îÄ‚Üí GET /api/package-subscriptions/my-subscriptions
   ‚îú‚îÄ‚Üí GET /api/package-subscriptions/{id}/usage
   ‚îî‚îÄ‚Üí GET /api/package-subscriptions/vehicle/{vehicleId}/active

4. MUA G√ìI ƒêƒÇNG K√ù (Optional)
   ‚îú‚îÄ‚Üí GET /api/maintenance-packages (Xem c√°c g√≥i)
   ‚îî‚îÄ‚Üí POST /api/package-subscriptions/purchase

5. ƒê·∫∂T L·ªäCH H·∫∏N (SMART BOOKING)
   ‚îú‚îÄ‚Üí GET /api/maintenance-services (Xem d·ªãch v·ª•)
   ‚îú‚îÄ‚Üí GET /api/timeslots/available (Xem gi·ªù tr·ªëng)
   ‚îî‚îÄ‚Üí POST /api/appointments
       ‚îú‚îÄ‚Üí Backend t·ª± ƒë·ªông check subscription
       ‚îú‚îÄ‚Üí N·∫øu c√≥ subscription ‚Üí ServiceSource = "Subscription", Price = 0
       ‚îî‚îÄ‚Üí N·∫øu kh√¥ng c√≥ ‚Üí ServiceSource = "Extra", Price = gi√° d·ªãch v·ª•

6. XEM & QU·∫¢N L√ù L·ªäCH H·∫∏N
   ‚îú‚îÄ‚Üí GET /api/appointments/my-appointments
   ‚îú‚îÄ‚Üí GET /api/appointments/{id}
   ‚îú‚îÄ‚Üí POST /api/appointments/{id}/cancel
   ‚îî‚îÄ‚Üí POST /api/appointments/{id}/reschedule
```

---

## 10. FRONTEND IMPLEMENTATION CHECKLIST

### ‚úÖ Authentication Module
- [ ] Login page v·ªõi form validation
- [ ] Registration page v·ªõi email verification
- [ ] Forgot password flow
- [ ] JWT token storage & refresh logic
- [ ] Auto-redirect khi token h·∫øt h·∫°n

### ‚úÖ Profile Module
- [ ] View profile page
- [ ] Edit profile form
- [ ] Vehicle list page
- [ ] Add vehicle form

### ‚úÖ Subscription Module
- [ ] View my subscriptions page
- [ ] Subscription usage details
- [ ] Buy package page
- [ ] Package comparison table

### ‚úÖ Booking Module
- [ ] Service selection page
- [ ] Time slot picker (calendar view)
- [ ] Booking form v·ªõi smart subscription detection
- [ ] Booking confirmation page
- [ ] Show subscription info if applied

### ‚úÖ Appointment Management
- [ ] My appointments list
- [ ] Appointment details page
- [ ] Cancel appointment modal
- [ ] Reschedule appointment flow

### ‚úÖ UI/UX Features
- [ ] Loading spinners
- [ ] Success/Error toast notifications
- [ ] Confirmation modals
- [ ] Responsive design (mobile-first)
- [ ] Accessibility (WCAG 2.1)

---

## 11. TESTING SCENARIOS

### Scenario 1: Kh√°ch h√†ng m·ªõi ƒë·∫∑t l·ªãch (Kh√¥ng c√≥ subscription)
1. Register ‚Üí Verify email ‚Üí Login
2. Add vehicle
3. Browse services
4. Book appointment ‚Üí System shows: Price = 500,000 VNƒê, ServiceSource = "Extra"
5. Payment required

### Scenario 2: Kh√°ch h√†ng c√≥ subscription ƒë·∫∑t l·ªãch
1. Login (ƒë√£ c√≥ subscription active)
2. Browse services
3. Book appointment v·ªõi service c√≥ trong g√≥i
4. System auto-apply subscription ‚Üí Price = 0, ServiceSource = "Subscription"
5. Success message: "D·ªãch v·ª• ƒë∆∞·ª£c √°p d·ª•ng t·ª´ g√≥i. C√≤n X d·ªãch v·ª•."

### Scenario 3: Subscription h·∫øt h·∫°n
1. Login (subscription expired)
2. Book appointment
3. System shows: Price = full price, ServiceSource = "Extra"
4. Suggest buying new package

---

## üìû SUPPORT & DOCUMENTATION

- **Swagger UI**: `http://localhost:5153/swagger`
- **Postman Collection**: Contact backend team
- **API Issues**: Create GitHub issue
- **Frontend Examples**: Check `/frontend-examples` folder

---

**Last Updated**: 2024-10-10
**API Version**: v1
**Backend Framework**: ASP.NET Core 9.0
