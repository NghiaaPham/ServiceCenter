[2025-09-29 20:58:13.260 +07:00 INF] Now listening on: https://localhost:7077 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 20:58:13.343 +07:00 INF] Now listening on: http://localhost:5153 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 20:58:13.411 +07:00 INF] Application started. Press Ctrl+C to shut down. {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 20:58:13.420 +07:00 INF] Hosting environment: Development {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 20:58:13.425 +07:00 INF] Content root path: C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 20:58:14.057 +07:00 INF] Request: GET / {"SourceContext":"Program","RequestId":"0HNFVC0TK5JRA:00000001","RequestPath":"/","ConnectionId":"0HNFVC0TK5JRA"}
[2025-09-29 20:58:27.980 +07:00 INF] Request: POST /api/auth/login {"SourceContext":"Program","RequestId":"0HNFVC0TK5JRA:00000009","RequestPath":"/api/auth/login","ConnectionId":"0HNFVC0TK5JRA"}
[2025-09-29 20:58:35.135 +07:00 INF] User NghiaPham (ID: 8, Role: "Admin") logged in successfully from IP: 127.0.0.1, UserAgent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36 Edg/140.0.0.0 {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"9406723e-37c0-484d-ab94-3238f6e738bd","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Login (EVServiceCenter.API)","RequestId":"0HNFVC0TK5JRA:00000009","RequestPath":"/api/auth/login","ConnectionId":"0HNFVC0TK5JRA"}
[2025-09-29 20:58:39.148 +07:00 INF] Email sent successfully to admin01@evservice.com with subject: Thông báo đăng nhập {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.EmailService","ActionId":"9406723e-37c0-484d-ab94-3238f6e738bd","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Login (EVServiceCenter.API)","RequestId":"0HNFVC0TK5JRA:00000009","RequestPath":"/api/auth/login","ConnectionId":"0HNFVC0TK5JRA"}
[2025-09-29 20:59:00.993 +07:00 INF] Request: GET /api/auth/profile {"SourceContext":"Program","RequestId":"0HNFVC0TK5JRA:0000000B","RequestPath":"/api/auth/profile","ConnectionId":"0HNFVC0TK5JRA"}
[2025-09-29 21:00:36.699 +07:00 INF] Request: POST /api/customers {"SourceContext":"Program","RequestId":"0HNFVC0TK5JRA:0000000D","RequestPath":"/api/customers","ConnectionId":"0HNFVC0TK5JRA"}
[2025-09-29 21:00:36.996 +07:00 WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'. {"EventId":{"Id":30004,"Name":"Microsoft.EntityFrameworkCore.Database.Transaction.SavepointsDisabledBecauseOfMARS"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Transaction","ActionId":"cabac2f4-6f4e-40cd-bdfd-5b3746c2a180","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVC0TK5JRA:0000000D","RequestPath":"/api/customers","ConnectionId":"0HNFVC0TK5JRA"}
[2025-09-29 21:00:37.080 +07:00 ERR] An exception occurred in the database while saving changes for context type 'EVServiceCenter.Core.Entities.EVDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (KH2509001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:88431fa4-a9c1-472a-868b-4353902edf84
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken) {"EventId":{"Id":10000,"Name":"Microsoft.EntityFrameworkCore.Update.SaveChangesFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Update","ActionId":"cabac2f4-6f4e-40cd-bdfd-5b3746c2a180","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVC0TK5JRA:0000000D","RequestPath":"/api/customers","ConnectionId":"0HNFVC0TK5JRA"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (KH2509001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:88431fa4-a9c1-472a-868b-4353902edf84
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
[2025-09-29 21:00:37.429 +07:00 ERR] Error creating customer: Nguyễn Văn A {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository","ActionId":"cabac2f4-6f4e-40cd-bdfd-5b3746c2a180","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVC0TK5JRA:0000000D","RequestPath":"/api/customers","ConnectionId":"0HNFVC0TK5JRA"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (KH2509001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:88431fa4-a9c1-472a-868b-4353902edf84
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 790
[2025-09-29 21:00:37.889 +07:00 ERR] Error creating walk-in customer: Nguyễn Văn A {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerService","ActionId":"cabac2f4-6f4e-40cd-bdfd-5b3746c2a180","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVC0TK5JRA:0000000D","RequestPath":"/api/customers","ConnectionId":"0HNFVC0TK5JRA"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (KH2509001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:88431fa4-a9c1-472a-868b-4353902edf84
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 790
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 802
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerService.CreateWalkInCustomerAsync(CreateWalkInCustomerDto request, Int32 createdByUserId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerService.cs:line 320
[2025-09-29 21:00:38.232 +07:00 ERR] Error creating walk-in customer: Nguyễn Văn A {"SourceContext":"EVServiceCenter.API.Controllers.Customers.CustomersController","ActionId":"cabac2f4-6f4e-40cd-bdfd-5b3746c2a180","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVC0TK5JRA:0000000D","RequestPath":"/api/customers","ConnectionId":"0HNFVC0TK5JRA"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (KH2509001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:88431fa4-a9c1-472a-868b-4353902edf84
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 790
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 802
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerService.CreateWalkInCustomerAsync(CreateWalkInCustomerDto request, Int32 createdByUserId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerService.cs:line 320
   at EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer(CreateWalkInCustomerDto request) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API\Controllers\Customers\CustomersController.cs:line 275
[2025-09-29 21:01:30.584 +07:00 INF] Request: POST /api/customers {"SourceContext":"Program","RequestId":"0HNFVC0TK5JRA:0000000F","RequestPath":"/api/customers","ConnectionId":"0HNFVC0TK5JRA"}
[2025-09-29 21:02:16.205 +07:00 WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'. {"EventId":{"Id":30004,"Name":"Microsoft.EntityFrameworkCore.Database.Transaction.SavepointsDisabledBecauseOfMARS"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Transaction","ActionId":"cabac2f4-6f4e-40cd-bdfd-5b3746c2a180","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVC0TK5JRA:0000000F","RequestPath":"/api/customers","ConnectionId":"0HNFVC0TK5JRA"}
[2025-09-29 21:02:16.233 +07:00 ERR] An exception occurred in the database while saving changes for context type 'EVServiceCenter.Core.Entities.EVDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (KH2509001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:88431fa4-a9c1-472a-868b-4353902edf84
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken) {"EventId":{"Id":10000,"Name":"Microsoft.EntityFrameworkCore.Update.SaveChangesFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Update","ActionId":"cabac2f4-6f4e-40cd-bdfd-5b3746c2a180","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVC0TK5JRA:0000000F","RequestPath":"/api/customers","ConnectionId":"0HNFVC0TK5JRA"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (KH2509001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:88431fa4-a9c1-472a-868b-4353902edf84
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
[2025-09-29 21:02:16.300 +07:00 ERR] Error creating customer: Nguyễn Văn A {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository","ActionId":"cabac2f4-6f4e-40cd-bdfd-5b3746c2a180","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVC0TK5JRA:0000000F","RequestPath":"/api/customers","ConnectionId":"0HNFVC0TK5JRA"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (KH2509001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:88431fa4-a9c1-472a-868b-4353902edf84
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 790
[2025-09-29 21:02:16.417 +07:00 ERR] Error creating walk-in customer: Nguyễn Văn A {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerService","ActionId":"cabac2f4-6f4e-40cd-bdfd-5b3746c2a180","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVC0TK5JRA:0000000F","RequestPath":"/api/customers","ConnectionId":"0HNFVC0TK5JRA"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (KH2509001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:88431fa4-a9c1-472a-868b-4353902edf84
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 790
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 802
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerService.CreateWalkInCustomerAsync(CreateWalkInCustomerDto request, Int32 createdByUserId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerService.cs:line 320
[2025-09-29 21:34:56.206 +07:00 INF] Now listening on: https://localhost:7077 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:34:56.263 +07:00 INF] Now listening on: http://localhost:5153 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:34:56.319 +07:00 INF] Application started. Press Ctrl+C to shut down. {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:34:56.336 +07:00 INF] Hosting environment: Development {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:34:56.346 +07:00 INF] Content root path: C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:34:57.024 +07:00 INF] Request: GET / {"SourceContext":"Program","RequestId":"0HNFVCLE7IUNC:00000001","RequestPath":"/","ConnectionId":"0HNFVCLE7IUNC"}
[2025-09-29 21:35:20.006 +07:00 INF] Request: GET /api/auth/profile {"SourceContext":"Program","RequestId":"0HNFVCLE7IUNC:00000009","RequestPath":"/api/auth/profile","ConnectionId":"0HNFVCLE7IUNC"}
[2025-09-29 21:35:37.605 +07:00 INF] Now listening on: https://localhost:7077 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:35:37.654 +07:00 INF] Now listening on: http://localhost:5153 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:35:37.707 +07:00 INF] Application started. Press Ctrl+C to shut down. {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:35:37.711 +07:00 INF] Hosting environment: Development {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:35:37.714 +07:00 INF] Content root path: C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:35:38.370 +07:00 INF] Request: GET / {"SourceContext":"Program","RequestId":"0HNFVCLQJ1M4M:00000001","RequestPath":"/","ConnectionId":"0HNFVCLQJ1M4M"}
[2025-09-29 21:35:58.826 +07:00 INF] Request: GET /api/auth/profile {"SourceContext":"Program","RequestId":"0HNFVCLQJ1M4M:00000009","RequestPath":"/api/auth/profile","ConnectionId":"0HNFVCLQJ1M4M"}
[2025-09-29 21:36:15.308 +07:00 INF] Request: POST /api/auth/login {"SourceContext":"Program","RequestId":"0HNFVCLQJ1M4M:0000000B","RequestPath":"/api/auth/login","ConnectionId":"0HNFVCLQJ1M4M"}
[2025-09-29 21:36:20.870 +07:00 INF] User NghiaPham (ID: 8, Role: "Admin") logged in successfully from IP: 127.0.0.1, UserAgent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36 Edg/140.0.0.0 {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"5dfbfe19-ee20-45a9-98a7-3c84528f5bf6","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Login (EVServiceCenter.API)","RequestId":"0HNFVCLQJ1M4M:0000000B","RequestPath":"/api/auth/login","ConnectionId":"0HNFVCLQJ1M4M"}
[2025-09-29 21:36:24.618 +07:00 INF] Email sent successfully to admin01@evservice.com with subject: Thông báo đăng nhập {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.EmailService","ActionId":"5dfbfe19-ee20-45a9-98a7-3c84528f5bf6","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Login (EVServiceCenter.API)","RequestId":"0HNFVCLQJ1M4M:0000000B","RequestPath":"/api/auth/login","ConnectionId":"0HNFVCLQJ1M4M"}
[2025-09-29 21:36:39.955 +07:00 INF] Request: GET /api/auth/profile {"SourceContext":"Program","RequestId":"0HNFVCLQJ1M4M:0000000D","RequestPath":"/api/auth/profile","ConnectionId":"0HNFVCLQJ1M4M"}
[2025-09-29 21:36:50.212 +07:00 INF] Request: GET /api/customers/maintenance-due {"SourceContext":"Program","RequestId":"0HNFVCLQJ1M4M:0000000F","RequestPath":"/api/customers/maintenance-due","ConnectionId":"0HNFVCLQJ1M4M"}
[2025-09-29 21:37:04.932 +07:00 INF] Request: POST /api/customers {"SourceContext":"Program","RequestId":"0HNFVCLQJ1M4M:00000011","RequestPath":"/api/customers","ConnectionId":"0HNFVCLQJ1M4M"}
[2025-09-29 21:37:25.042 +07:00 WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results. {"EventId":{"Id":10103,"Name":"Microsoft.EntityFrameworkCore.Query.FirstWithoutOrderByAndFilterWarning"},"SourceContext":"Microsoft.EntityFrameworkCore.Query","ActionId":"f59c8d50-9b6f-49aa-8831-14f09f99b5d4","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCLQJ1M4M:00000011","RequestPath":"/api/customers","ConnectionId":"0HNFVCLQJ1M4M"}
[2025-09-29 21:37:25.087 +07:00 ERR] Failed executing DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [s].[Value]
FROM (
    SELECT NEXT VALUE FOR CustomerCodeSeq
) AS [s] {"EventId":{"Id":20102,"Name":"Microsoft.EntityFrameworkCore.Database.Command.CommandError"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Command","ActionId":"f59c8d50-9b6f-49aa-8831-14f09f99b5d4","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCLQJ1M4M:00000011","RequestPath":"/api/customers","ConnectionId":"0HNFVCLQJ1M4M"}
[2025-09-29 21:37:25.120 +07:00 ERR] An exception occurred while iterating over the results of a query for context type 'EVServiceCenter.Core.Entities.EVDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:c7869d41-86f0-4730-a944-1701623c5b41
Error Number:11719,State:1,Class:15 {"EventId":{"Id":10100,"Name":"Microsoft.EntityFrameworkCore.Query.QueryIterationFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Query","ActionId":"f59c8d50-9b6f-49aa-8831-14f09f99b5d4","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCLQJ1M4M:00000011","RequestPath":"/api/customers","ConnectionId":"0HNFVCLQJ1M4M"}
Microsoft.Data.SqlClient.SqlException (0x80131904): NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:c7869d41-86f0-4730-a944-1701623c5b41
Error Number:11719,State:1,Class:15
[2025-09-29 21:37:25.221 +07:00 ERR] Error generating customer code with sequence {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository","ActionId":"f59c8d50-9b6f-49aa-8831-14f09f99b5d4","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCLQJ1M4M:00000011","RequestPath":"/api/customers","ConnectionId":"0HNFVCLQJ1M4M"}
Microsoft.Data.SqlClient.SqlException (0x80131904): NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.GenerateCustomerCodeAsync(CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 507
ClientConnectionId:c7869d41-86f0-4730-a944-1701623c5b41
Error Number:11719,State:1,Class:15
[2025-09-29 21:37:25.378 +07:00 ERR] Error creating customer: Nguyễn Văn A {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository","ActionId":"f59c8d50-9b6f-49aa-8831-14f09f99b5d4","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCLQJ1M4M:00000011","RequestPath":"/api/customers","ConnectionId":"0HNFVCLQJ1M4M"}
Microsoft.Data.SqlClient.SqlException (0x80131904): NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.GenerateCustomerCodeAsync(CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 507
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 754
ClientConnectionId:c7869d41-86f0-4730-a944-1701623c5b41
Error Number:11719,State:1,Class:15
[2025-09-29 21:37:25.477 +07:00 ERR] Error creating walk-in customer: Nguyễn Văn A {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerService","ActionId":"f59c8d50-9b6f-49aa-8831-14f09f99b5d4","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCLQJ1M4M:00000011","RequestPath":"/api/customers","ConnectionId":"0HNFVCLQJ1M4M"}
Microsoft.Data.SqlClient.SqlException (0x80131904): NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.GenerateCustomerCodeAsync(CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 507
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 754
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 790
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerService.CreateWalkInCustomerAsync(CreateWalkInCustomerDto request, Int32 createdByUserId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerService.cs:line 319
ClientConnectionId:c7869d41-86f0-4730-a944-1701623c5b41
Error Number:11719,State:1,Class:15
[2025-09-29 21:37:29.907 +07:00 ERR] Error creating walk-in customer: Nguyễn Văn A {"SourceContext":"EVServiceCenter.API.Controllers.Customers.CustomersController","ActionId":"f59c8d50-9b6f-49aa-8831-14f09f99b5d4","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCLQJ1M4M:00000011","RequestPath":"/api/customers","ConnectionId":"0HNFVCLQJ1M4M"}
Microsoft.Data.SqlClient.SqlException (0x80131904): NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.GenerateCustomerCodeAsync(CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 507
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 754
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 790
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerService.CreateWalkInCustomerAsync(CreateWalkInCustomerDto request, Int32 createdByUserId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerService.cs:line 319
   at EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer(CreateWalkInCustomerDto request) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API\Controllers\Customers\CustomersController.cs:line 275
ClientConnectionId:c7869d41-86f0-4730-a944-1701623c5b41
Error Number:11719,State:1,Class:15
[2025-09-29 21:38:25.686 +07:00 INF] Request: POST /api/customers {"SourceContext":"Program","RequestId":"0HNFVCLQJ1M4M:00000013","RequestPath":"/api/customers","ConnectionId":"0HNFVCLQJ1M4M"}
[2025-09-29 21:40:08.213 +07:00 ERR] Failed executing DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [s].[Value]
FROM (
    SELECT NEXT VALUE FOR CustomerCodeSeq
) AS [s] {"EventId":{"Id":20102,"Name":"Microsoft.EntityFrameworkCore.Database.Command.CommandError"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Command","ActionId":"f59c8d50-9b6f-49aa-8831-14f09f99b5d4","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCLQJ1M4M:00000013","RequestPath":"/api/customers","ConnectionId":"0HNFVCLQJ1M4M"}
[2025-09-29 21:40:08.426 +07:00 ERR] An exception occurred while iterating over the results of a query for context type 'EVServiceCenter.Core.Entities.EVDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:c7869d41-86f0-4730-a944-1701623c5b41
Error Number:11719,State:1,Class:15 {"EventId":{"Id":10100,"Name":"Microsoft.EntityFrameworkCore.Query.QueryIterationFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Query","ActionId":"f59c8d50-9b6f-49aa-8831-14f09f99b5d4","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCLQJ1M4M:00000013","RequestPath":"/api/customers","ConnectionId":"0HNFVCLQJ1M4M"}
Microsoft.Data.SqlClient.SqlException (0x80131904): NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:c7869d41-86f0-4730-a944-1701623c5b41
Error Number:11719,State:1,Class:15
[2025-09-29 21:41:20.396 +07:00 ERR] Error generating customer code with sequence {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository","ActionId":"f59c8d50-9b6f-49aa-8831-14f09f99b5d4","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCLQJ1M4M:00000013","RequestPath":"/api/customers","ConnectionId":"0HNFVCLQJ1M4M"}
Microsoft.Data.SqlClient.SqlException (0x80131904): NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.GenerateCustomerCodeAsync(CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 507
ClientConnectionId:c7869d41-86f0-4730-a944-1701623c5b41
Error Number:11719,State:1,Class:15
[2025-09-29 21:41:20.744 +07:00 ERR] Error creating customer: Nguyễn Văn A {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository","ActionId":"f59c8d50-9b6f-49aa-8831-14f09f99b5d4","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCLQJ1M4M:00000013","RequestPath":"/api/customers","ConnectionId":"0HNFVCLQJ1M4M"}
Microsoft.Data.SqlClient.SqlException (0x80131904): NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.GenerateCustomerCodeAsync(CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 507
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 754
ClientConnectionId:c7869d41-86f0-4730-a944-1701623c5b41
Error Number:11719,State:1,Class:15
[2025-09-29 21:41:20.919 +07:00 ERR] Error creating walk-in customer: Nguyễn Văn A {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerService","ActionId":"f59c8d50-9b6f-49aa-8831-14f09f99b5d4","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCLQJ1M4M:00000013","RequestPath":"/api/customers","ConnectionId":"0HNFVCLQJ1M4M"}
Microsoft.Data.SqlClient.SqlException (0x80131904): NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.GenerateCustomerCodeAsync(CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 507
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 754
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 790
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerService.CreateWalkInCustomerAsync(CreateWalkInCustomerDto request, Int32 createdByUserId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerService.cs:line 319
ClientConnectionId:c7869d41-86f0-4730-a944-1701623c5b41
Error Number:11719,State:1,Class:15
[2025-09-29 21:41:21.100 +07:00 ERR] Error creating walk-in customer: Nguyễn Văn A {"SourceContext":"EVServiceCenter.API.Controllers.Customers.CustomersController","ActionId":"f59c8d50-9b6f-49aa-8831-14f09f99b5d4","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCLQJ1M4M:00000013","RequestPath":"/api/customers","ConnectionId":"0HNFVCLQJ1M4M"}
Microsoft.Data.SqlClient.SqlException (0x80131904): NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.GenerateCustomerCodeAsync(CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 507
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 754
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 790
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerService.CreateWalkInCustomerAsync(CreateWalkInCustomerDto request, Int32 createdByUserId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerService.cs:line 319
   at EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer(CreateWalkInCustomerDto request) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API\Controllers\Customers\CustomersController.cs:line 275
ClientConnectionId:c7869d41-86f0-4730-a944-1701623c5b41
Error Number:11719,State:1,Class:15
[2025-09-29 21:41:40.370 +07:00 INF] Now listening on: https://localhost:7077 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:41:40.418 +07:00 INF] Now listening on: http://localhost:5153 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:41:40.468 +07:00 INF] Application started. Press Ctrl+C to shut down. {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:41:40.473 +07:00 INF] Hosting environment: Development {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:41:40.479 +07:00 INF] Content root path: C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:41:40.959 +07:00 INF] Request: GET / {"SourceContext":"Program","RequestId":"0HNFVCP6KHM0V:00000001","RequestPath":"/","ConnectionId":"0HNFVCP6KHM0V"}
[2025-09-29 21:41:54.048 +07:00 INF] Request: GET /api/auth/profile {"SourceContext":"Program","RequestId":"0HNFVCP6KHM0V:00000009","RequestPath":"/api/auth/profile","ConnectionId":"0HNFVCP6KHM0V"}
[2025-09-29 21:42:11.379 +07:00 INF] Request: GET /api/customers {"SourceContext":"Program","RequestId":"0HNFVCP6KHM0V:0000000B","RequestPath":"/api/customers","ConnectionId":"0HNFVCP6KHM0V"}
[2025-09-29 21:42:38.206 +07:00 INF] Request: POST /api/customers {"SourceContext":"Program","RequestId":"0HNFVCP6KHM0V:0000000D","RequestPath":"/api/customers","ConnectionId":"0HNFVCP6KHM0V"}
[2025-09-29 21:42:38.666 +07:00 ERR] Error generating customer code with sequence {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository","ActionId":"2b0129fd-29b7-4a4e-8697-f608f2af1214","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCP6KHM0V:0000000D","RequestPath":"/api/customers","ConnectionId":"0HNFVCP6KHM0V"}
System.InvalidOperationException: BeginExecuteReader requires the command to have a transaction when the connection assigned to the command is in a pending local transaction.  The Transaction property of the command has not been initialized.
   at Microsoft.Data.SqlClient.SqlCommand.ValidateCommand(Boolean isAsync, String method)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry, String method)
   at Microsoft.Data.SqlClient.SqlCommand.BeginExecuteReaderInternal(CommandBehavior behavior, AsyncCallback callback, Object stateObject, Int32 timeout, Boolean inRetry, Boolean asyncWrite)
   at Microsoft.Data.SqlClient.SqlCommand.BeginExecuteReaderAsyncCallback(AsyncCallback callback, Object stateObject)
   at System.Threading.Tasks.TaskFactory`1.FromAsyncImpl(Func`3 beginMethod, Func`2 endFunction, Action`1 endAction, Object state, TaskCreationOptions creationOptions)
   at System.Threading.Tasks.TaskFactory`1.FromAsync(Func`3 beginMethod, Func`2 endMethod, Object state)
   at Microsoft.Data.SqlClient.SqlCommand.InternalExecuteReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.GenerateCustomerCodeAsync(CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 515
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.GenerateCustomerCodeAsync(CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 516
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.GenerateCustomerCodeAsync(CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 517
[2025-09-29 21:42:38.826 +07:00 ERR] An error occurred using a transaction. {"EventId":{"Id":20205,"Name":"Microsoft.EntityFrameworkCore.Database.Transaction.TransactionError"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Transaction","ActionId":"2b0129fd-29b7-4a4e-8697-f608f2af1214","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCP6KHM0V:0000000D","RequestPath":"/api/customers","ConnectionId":"0HNFVCP6KHM0V"}
[2025-09-29 21:42:38.894 +07:00 ERR] Error creating walk-in customer: Nguyễn Văn A {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerService","ActionId":"2b0129fd-29b7-4a4e-8697-f608f2af1214","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCP6KHM0V:0000000D","RequestPath":"/api/customers","ConnectionId":"0HNFVCP6KHM0V"}
System.InvalidOperationException: This SqlTransaction has completed; it is no longer usable.
   at Microsoft.Data.SqlClient.SqlTransaction.ZombieCheck()
   at Microsoft.Data.SqlClient.SqlTransaction.Rollback()
   at System.Data.Common.DbTransaction.RollbackAsync(CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalTransaction.RollbackAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalTransaction.RollbackAsync(CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 795
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerService.CreateWalkInCustomerAsync(CreateWalkInCustomerDto request, Int32 createdByUserId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerService.cs:line 319
[2025-09-29 21:43:38.552 +07:00 INF] Request: POST /api/customers {"SourceContext":"Program","RequestId":"0HNFVCP6KHM0V:0000000F","RequestPath":"/api/customers","ConnectionId":"0HNFVCP6KHM0V"}
[2025-09-29 21:43:46.558 +07:00 ERR] Error generating customer code with sequence {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository","ActionId":"2b0129fd-29b7-4a4e-8697-f608f2af1214","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCP6KHM0V:0000000F","RequestPath":"/api/customers","ConnectionId":"0HNFVCP6KHM0V"}
System.InvalidOperationException: BeginExecuteReader requires the command to have a transaction when the connection assigned to the command is in a pending local transaction.  The Transaction property of the command has not been initialized.
   at Microsoft.Data.SqlClient.SqlCommand.ValidateCommand(Boolean isAsync, String method)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry, String method)
   at Microsoft.Data.SqlClient.SqlCommand.BeginExecuteReaderInternal(CommandBehavior behavior, AsyncCallback callback, Object stateObject, Int32 timeout, Boolean inRetry, Boolean asyncWrite)
   at Microsoft.Data.SqlClient.SqlCommand.BeginExecuteReaderAsyncCallback(AsyncCallback callback, Object stateObject)
   at System.Threading.Tasks.TaskFactory`1.FromAsyncImpl(Func`3 beginMethod, Func`2 endFunction, Action`1 endAction, Object state, TaskCreationOptions creationOptions)
   at System.Threading.Tasks.TaskFactory`1.FromAsync(Func`3 beginMethod, Func`2 endMethod, Object state)
   at Microsoft.Data.SqlClient.SqlCommand.InternalExecuteReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.GenerateCustomerCodeAsync(CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 515
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.GenerateCustomerCodeAsync(CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 516
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.GenerateCustomerCodeAsync(CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 517
[2025-09-29 21:43:46.615 +07:00 ERR] An error occurred using a transaction. {"EventId":{"Id":20205,"Name":"Microsoft.EntityFrameworkCore.Database.Transaction.TransactionError"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Transaction","ActionId":"2b0129fd-29b7-4a4e-8697-f608f2af1214","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCP6KHM0V:0000000F","RequestPath":"/api/customers","ConnectionId":"0HNFVCP6KHM0V"}
[2025-09-29 21:44:07.733 +07:00 ERR] Error creating walk-in customer: Nguyễn Văn A {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerService","ActionId":"2b0129fd-29b7-4a4e-8697-f608f2af1214","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCP6KHM0V:0000000F","RequestPath":"/api/customers","ConnectionId":"0HNFVCP6KHM0V"}
System.InvalidOperationException: This SqlTransaction has completed; it is no longer usable.
   at Microsoft.Data.SqlClient.SqlTransaction.ZombieCheck()
   at Microsoft.Data.SqlClient.SqlTransaction.Rollback()
   at System.Data.Common.DbTransaction.RollbackAsync(CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalTransaction.RollbackAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalTransaction.RollbackAsync(CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 795
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerService.CreateWalkInCustomerAsync(CreateWalkInCustomerDto request, Int32 createdByUserId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerService.cs:line 319
[2025-09-29 21:44:10.092 +07:00 INF] Request: POST /api/customers {"SourceContext":"Program","RequestId":"0HNFVCP6KHM0V:00000011","RequestPath":"/api/customers","ConnectionId":"0HNFVCP6KHM0V"}
[2025-09-29 21:44:36.816 +07:00 ERR] Error generating customer code with sequence {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository","ActionId":"2b0129fd-29b7-4a4e-8697-f608f2af1214","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCP6KHM0V:00000011","RequestPath":"/api/customers","ConnectionId":"0HNFVCP6KHM0V"}
System.InvalidOperationException: BeginExecuteReader requires the command to have a transaction when the connection assigned to the command is in a pending local transaction.  The Transaction property of the command has not been initialized.
   at Microsoft.Data.SqlClient.SqlCommand.ValidateCommand(Boolean isAsync, String method)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry, String method)
   at Microsoft.Data.SqlClient.SqlCommand.BeginExecuteReaderInternal(CommandBehavior behavior, AsyncCallback callback, Object stateObject, Int32 timeout, Boolean inRetry, Boolean asyncWrite)
   at Microsoft.Data.SqlClient.SqlCommand.BeginExecuteReaderAsyncCallback(AsyncCallback callback, Object stateObject)
   at System.Threading.Tasks.TaskFactory`1.FromAsyncImpl(Func`3 beginMethod, Func`2 endFunction, Action`1 endAction, Object state, TaskCreationOptions creationOptions)
   at System.Threading.Tasks.TaskFactory`1.FromAsync(Func`3 beginMethod, Func`2 endMethod, Object state)
   at Microsoft.Data.SqlClient.SqlCommand.InternalExecuteReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.GenerateCustomerCodeAsync(CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 515
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.GenerateCustomerCodeAsync(CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 516
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.GenerateCustomerCodeAsync(CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 517
[2025-09-29 21:44:48.401 +07:00 ERR] An error occurred using a transaction. {"EventId":{"Id":20205,"Name":"Microsoft.EntityFrameworkCore.Database.Transaction.TransactionError"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Transaction","ActionId":"2b0129fd-29b7-4a4e-8697-f608f2af1214","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCP6KHM0V:00000011","RequestPath":"/api/customers","ConnectionId":"0HNFVCP6KHM0V"}
[2025-09-29 21:44:48.471 +07:00 ERR] Error creating walk-in customer: Nguyễn Văn A {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerService","ActionId":"2b0129fd-29b7-4a4e-8697-f608f2af1214","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCP6KHM0V:00000011","RequestPath":"/api/customers","ConnectionId":"0HNFVCP6KHM0V"}
System.InvalidOperationException: This SqlTransaction has completed; it is no longer usable.
   at Microsoft.Data.SqlClient.SqlTransaction.ZombieCheck()
   at Microsoft.Data.SqlClient.SqlTransaction.Rollback()
   at System.Data.Common.DbTransaction.RollbackAsync(CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalTransaction.RollbackAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalTransaction.RollbackAsync(CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 795
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerService.CreateWalkInCustomerAsync(CreateWalkInCustomerDto request, Int32 createdByUserId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerService.cs:line 319
[2025-09-29 21:47:53.212 +07:00 INF] Now listening on: https://localhost:7077 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:47:53.264 +07:00 INF] Now listening on: http://localhost:5153 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:47:53.356 +07:00 INF] Application started. Press Ctrl+C to shut down. {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:47:53.361 +07:00 INF] Hosting environment: Development {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:47:53.365 +07:00 INF] Content root path: C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:47:53.899 +07:00 INF] Request: GET / {"SourceContext":"Program","RequestId":"0HNFVCSLNPISS:00000001","RequestPath":"/","ConnectionId":"0HNFVCSLNPISS"}
[2025-09-29 21:48:14.290 +07:00 INF] Request: POST /api/customers {"SourceContext":"Program","RequestId":"0HNFVCSLNPISS:00000009","RequestPath":"/api/customers","ConnectionId":"0HNFVCSLNPISS"}
[2025-09-29 21:48:31.324 +07:00 INF] Request: POST /api/customers {"SourceContext":"Program","RequestId":"0HNFVCSLNPISS:0000000B","RequestPath":"/api/customers","ConnectionId":"0HNFVCSLNPISS"}
[2025-09-29 21:49:01.775 +07:00 WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results. {"EventId":{"Id":10103,"Name":"Microsoft.EntityFrameworkCore.Query.FirstWithoutOrderByAndFilterWarning"},"SourceContext":"Microsoft.EntityFrameworkCore.Query","ActionId":"854ca0c2-b1fc-4f26-86b4-1f39b8f331af","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCSLNPISS:0000000B","RequestPath":"/api/customers","ConnectionId":"0HNFVCSLNPISS"}
[2025-09-29 21:49:01.830 +07:00 ERR] Failed executing DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [s].[Value]
FROM (
    SELECT NEXT VALUE FOR CustomerCodeSeq
) AS [s] {"EventId":{"Id":20102,"Name":"Microsoft.EntityFrameworkCore.Database.Command.CommandError"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Command","ActionId":"854ca0c2-b1fc-4f26-86b4-1f39b8f331af","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCSLNPISS:0000000B","RequestPath":"/api/customers","ConnectionId":"0HNFVCSLNPISS"}
[2025-09-29 21:49:01.863 +07:00 ERR] An exception occurred while iterating over the results of a query for context type 'EVServiceCenter.Core.Entities.EVDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:28b54ef3-c5ce-40c3-92b5-b1795ed400c8
Error Number:11719,State:1,Class:15 {"EventId":{"Id":10100,"Name":"Microsoft.EntityFrameworkCore.Query.QueryIterationFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Query","ActionId":"854ca0c2-b1fc-4f26-86b4-1f39b8f331af","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCSLNPISS:0000000B","RequestPath":"/api/customers","ConnectionId":"0HNFVCSLNPISS"}
Microsoft.Data.SqlClient.SqlException (0x80131904): NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:28b54ef3-c5ce-40c3-92b5-b1795ed400c8
Error Number:11719,State:1,Class:15
[2025-09-29 21:51:43.975 +07:00 INF] Now listening on: https://localhost:7077 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:51:44.027 +07:00 INF] Now listening on: http://localhost:5153 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:51:44.083 +07:00 INF] Application started. Press Ctrl+C to shut down. {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:51:44.086 +07:00 INF] Hosting environment: Development {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:51:44.092 +07:00 INF] Content root path: C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:51:44.683 +07:00 INF] Request: GET / {"SourceContext":"Program","RequestId":"0HNFVCUQHUIE8:00000001","RequestPath":"/","ConnectionId":"0HNFVCUQHUIE8"}
[2025-09-29 21:52:21.443 +07:00 INF] Request: POST /api/customers {"SourceContext":"Program","RequestId":"0HNFVCUQHUIE8:00000009","RequestPath":"/api/customers","ConnectionId":"0HNFVCUQHUIE8"}
[2025-09-29 21:52:27.752 +07:00 WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'. {"EventId":{"Id":30004,"Name":"Microsoft.EntityFrameworkCore.Database.Transaction.SavepointsDisabledBecauseOfMARS"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Transaction","ActionId":"62411bf7-e364-480d-b82e-eff414c6af1a","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCUQHUIE8:00000009","RequestPath":"/api/customers","ConnectionId":"0HNFVCUQHUIE8"}
[2025-09-29 21:52:27.870 +07:00 ERR] An exception occurred in the database while saving changes for context type 'EVServiceCenter.Core.Entities.EVDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (KH2509001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:f91a10e5-8bca-4224-b0fe-d0c27550e3e5
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken) {"EventId":{"Id":10000,"Name":"Microsoft.EntityFrameworkCore.Update.SaveChangesFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Update","ActionId":"62411bf7-e364-480d-b82e-eff414c6af1a","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCUQHUIE8:00000009","RequestPath":"/api/customers","ConnectionId":"0HNFVCUQHUIE8"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (KH2509001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:f91a10e5-8bca-4224-b0fe-d0c27550e3e5
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
[2025-09-29 21:52:28.247 +07:00 ERR] Error creating customer: Nguyễn Văn A {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository","ActionId":"62411bf7-e364-480d-b82e-eff414c6af1a","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCUQHUIE8:00000009","RequestPath":"/api/customers","ConnectionId":"0HNFVCUQHUIE8"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (KH2509001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:f91a10e5-8bca-4224-b0fe-d0c27550e3e5
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 773
[2025-09-29 21:52:28.670 +07:00 ERR] Error creating walk-in customer: Nguyễn Văn A {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerService","ActionId":"62411bf7-e364-480d-b82e-eff414c6af1a","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCUQHUIE8:00000009","RequestPath":"/api/customers","ConnectionId":"0HNFVCUQHUIE8"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (KH2509001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:f91a10e5-8bca-4224-b0fe-d0c27550e3e5
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 773
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 785
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerService.CreateWalkInCustomerAsync(CreateWalkInCustomerDto request, Int32 createdByUserId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerService.cs:line 319
[2025-09-29 21:52:28.867 +07:00 ERR] Error creating walk-in customer: Nguyễn Văn A {"SourceContext":"EVServiceCenter.API.Controllers.Customers.CustomersController","ActionId":"62411bf7-e364-480d-b82e-eff414c6af1a","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCUQHUIE8:00000009","RequestPath":"/api/customers","ConnectionId":"0HNFVCUQHUIE8"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (KH2509001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:f91a10e5-8bca-4224-b0fe-d0c27550e3e5
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 773
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 785
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerService.CreateWalkInCustomerAsync(CreateWalkInCustomerDto request, Int32 createdByUserId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerService.cs:line 319
   at EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer(CreateWalkInCustomerDto request) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API\Controllers\Customers\CustomersController.cs:line 275
[2025-09-29 21:52:45.840 +07:00 INF] Now listening on: https://localhost:7077 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:52:45.884 +07:00 INF] Now listening on: http://localhost:5153 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:52:45.945 +07:00 INF] Application started. Press Ctrl+C to shut down. {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:52:45.951 +07:00 INF] Hosting environment: Development {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:52:45.958 +07:00 INF] Content root path: C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 21:52:46.484 +07:00 INF] Request: GET / {"SourceContext":"Program","RequestId":"0HNFVCVCVTOJ6:00000001","RequestPath":"/","ConnectionId":"0HNFVCVCVTOJ6"}
[2025-09-29 21:53:16.299 +07:00 INF] Request: POST /api/customers {"SourceContext":"Program","RequestId":"0HNFVCVCVTOJ6:00000009","RequestPath":"/api/customers","ConnectionId":"0HNFVCVCVTOJ6"}
[2025-09-29 21:53:19.380 +07:00 WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'. {"EventId":{"Id":30004,"Name":"Microsoft.EntityFrameworkCore.Database.Transaction.SavepointsDisabledBecauseOfMARS"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Transaction","ActionId":"7102ba43-2e7e-45b3-b563-f94c13843259","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCVCVTOJ6:00000009","RequestPath":"/api/customers","ConnectionId":"0HNFVCVCVTOJ6"}
[2025-09-29 21:53:19.478 +07:00 ERR] An exception occurred in the database while saving changes for context type 'EVServiceCenter.Core.Entities.EVDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ_Customers_UserID'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (<NULL>).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:9eb1d428-5f19-43a2-b543-d3d051a265fa
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken) {"EventId":{"Id":10000,"Name":"Microsoft.EntityFrameworkCore.Update.SaveChangesFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Update","ActionId":"7102ba43-2e7e-45b3-b563-f94c13843259","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCVCVTOJ6:00000009","RequestPath":"/api/customers","ConnectionId":"0HNFVCVCVTOJ6"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ_Customers_UserID'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (<NULL>).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:9eb1d428-5f19-43a2-b543-d3d051a265fa
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
[2025-09-29 21:53:19.807 +07:00 ERR] Error creating customer: Nguyễn Văn A {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository","ActionId":"7102ba43-2e7e-45b3-b563-f94c13843259","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCVCVTOJ6:00000009","RequestPath":"/api/customers","ConnectionId":"0HNFVCVCVTOJ6"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ_Customers_UserID'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (<NULL>).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:9eb1d428-5f19-43a2-b543-d3d051a265fa
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 773
[2025-09-29 21:53:20.102 +07:00 ERR] Error creating walk-in customer: Nguyễn Văn A {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerService","ActionId":"7102ba43-2e7e-45b3-b563-f94c13843259","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCVCVTOJ6:00000009","RequestPath":"/api/customers","ConnectionId":"0HNFVCVCVTOJ6"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ_Customers_UserID'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (<NULL>).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:9eb1d428-5f19-43a2-b543-d3d051a265fa
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 773
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 785
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerService.CreateWalkInCustomerAsync(CreateWalkInCustomerDto request, Int32 createdByUserId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerService.cs:line 319
[2025-09-29 21:53:20.414 +07:00 ERR] Error creating walk-in customer: Nguyễn Văn A {"SourceContext":"EVServiceCenter.API.Controllers.Customers.CustomersController","ActionId":"7102ba43-2e7e-45b3-b563-f94c13843259","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVCVCVTOJ6:00000009","RequestPath":"/api/customers","ConnectionId":"0HNFVCVCVTOJ6"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ_Customers_UserID'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (<NULL>).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:9eb1d428-5f19-43a2-b543-d3d051a265fa
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 773
   at EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository.CreateAsync(CreateCustomerRequestDto request, Nullable`1 userId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Repositories\CustomerRepository.cs:line 785
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerService.CreateWalkInCustomerAsync(CreateWalkInCustomerDto request, Int32 createdByUserId, CancellationToken cancellationToken) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerService.cs:line 319
   at EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer(CreateWalkInCustomerDto request) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API\Controllers\Customers\CustomersController.cs:line 275
[2025-09-29 22:02:24.575 +07:00 INF] Now listening on: https://localhost:7077 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 22:02:24.649 +07:00 INF] Now listening on: http://localhost:5153 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 22:02:24.763 +07:00 INF] Application started. Press Ctrl+C to shut down. {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 22:02:24.767 +07:00 INF] Hosting environment: Development {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 22:02:24.772 +07:00 INF] Content root path: C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 22:02:25.169 +07:00 INF] Request: GET / {"SourceContext":"Program","RequestId":"0HNFVD4PEH7CA:00000001","RequestPath":"/","ConnectionId":"0HNFVD4PEH7CA"}
[2025-09-29 22:03:16.169 +07:00 INF] Request: POST /api/customers {"SourceContext":"Program","RequestId":"0HNFVD4PEH7CA:00000009","RequestPath":"/api/customers","ConnectionId":"0HNFVD4PEH7CA"}
[2025-09-29 22:03:21.694 +07:00 WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'. {"EventId":{"Id":30004,"Name":"Microsoft.EntityFrameworkCore.Database.Transaction.SavepointsDisabledBecauseOfMARS"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Transaction","ActionId":"ec25fd5d-97ee-4a52-83af-963df10b19a2","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVD4PEH7CA:00000009","RequestPath":"/api/customers","ConnectionId":"0HNFVD4PEH7CA"}
[2025-09-29 22:03:21.781 +07:00 INF] Created customer: KH2509003 - Nguyễn Văn A {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository","ActionId":"ec25fd5d-97ee-4a52-83af-963df10b19a2","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVD4PEH7CA:00000009","RequestPath":"/api/customers","ConnectionId":"0HNFVD4PEH7CA"}
[2025-09-29 22:03:21.963 +07:00 INF] Walk-in customer created: KH2509003 - Nguyễn Văn A by user 8 {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerService","ActionId":"ec25fd5d-97ee-4a52-83af-963df10b19a2","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVD4PEH7CA:00000009","RequestPath":"/api/customers","ConnectionId":"0HNFVD4PEH7CA"}
[2025-09-29 22:03:21.986 +07:00 INF] Walk-in customer created by user 8: KH2509003 - Nguyễn Văn A {"SourceContext":"EVServiceCenter.API.Controllers.Customers.CustomersController","ActionId":"ec25fd5d-97ee-4a52-83af-963df10b19a2","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomersController.CreateCustomer (EVServiceCenter.API)","RequestId":"0HNFVD4PEH7CA:00000009","RequestPath":"/api/customers","ConnectionId":"0HNFVD4PEH7CA"}
[2025-09-29 22:07:21.151 +07:00 INF] Request: POST /api/customer/register {"SourceContext":"Program","RequestId":"0HNFVD4PEH7CA:0000000B","RequestPath":"/api/customer/register","ConnectionId":"0HNFVD4PEH7CA"}
[2025-09-29 22:07:22.467 +07:00 WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'. {"EventId":{"Id":30004,"Name":"Microsoft.EntityFrameworkCore.Database.Transaction.SavepointsDisabledBecauseOfMARS"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Transaction","ActionId":"b67081e8-d554-4ca2-8cf2-c534ad10e6aa","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFVD4PEH7CA:0000000B","RequestPath":"/api/customer/register","ConnectionId":"0HNFVD4PEH7CA"}
[2025-09-29 22:07:27.484 +07:00 INF] Email sent successfully to nghiadaucau1@gmail.com with subject: Xác thực tài khoản EV Service Center {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.EmailService","ActionId":"b67081e8-d554-4ca2-8cf2-c534ad10e6aa","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFVD4PEH7CA:0000000B","RequestPath":"/api/customer/register","ConnectionId":"0HNFVD4PEH7CA"}
[2025-09-29 22:07:27.544 +07:00 INF] Verification email sent to customer nghiadaucau1@gmail.com for user nghiadaucau1@gmail.com {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"b67081e8-d554-4ca2-8cf2-c534ad10e6aa","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFVD4PEH7CA:0000000B","RequestPath":"/api/customer/register","ConnectionId":"0HNFVD4PEH7CA"}
[2025-09-29 22:07:27.580 +07:00 INF] Customer user registered successfully: nghiadaucau1@gmail.com, Email: nghiadaucau1@gmail.com {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"b67081e8-d554-4ca2-8cf2-c534ad10e6aa","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFVD4PEH7CA:0000000B","RequestPath":"/api/customer/register","ConnectionId":"0HNFVD4PEH7CA"}
[2025-09-29 22:07:27.677 +07:00 WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'. {"EventId":{"Id":30004,"Name":"Microsoft.EntityFrameworkCore.Database.Transaction.SavepointsDisabledBecauseOfMARS"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Transaction","ActionId":"b67081e8-d554-4ca2-8cf2-c534ad10e6aa","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFVD4PEH7CA:0000000B","RequestPath":"/api/customer/register","ConnectionId":"0HNFVD4PEH7CA"}
[2025-09-29 22:07:27.804 +07:00 ERR] An exception occurred in the database while saving changes for context type 'EVServiceCenter.Core.Entities.EVDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (CUS000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:d1eeca01-d8e9-4753-8e90-82c4da3d572f
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken) {"EventId":{"Id":10000,"Name":"Microsoft.EntityFrameworkCore.Update.SaveChangesFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Update","ActionId":"b67081e8-d554-4ca2-8cf2-c534ad10e6aa","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFVD4PEH7CA:0000000B","RequestPath":"/api/customer/register","ConnectionId":"0HNFVD4PEH7CA"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (CUS000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:d1eeca01-d8e9-4753-8e90-82c4da3d572f
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
[2025-09-29 22:07:28.057 +07:00 ERR] Error creating customer with account: NghiaPham {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerAccountService","ActionId":"b67081e8-d554-4ca2-8cf2-c534ad10e6aa","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFVD4PEH7CA:0000000B","RequestPath":"/api/customer/register","ConnectionId":"0HNFVD4PEH7CA"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (CUS000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:d1eeca01-d8e9-4753-8e90-82c4da3d572f
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerAccountService.CreateCustomerWithAccountAsync(CreateCustomerRequestDto customerRequest, String password) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerAccountService.cs:line 107
[2025-09-29 22:07:28.488 +07:00 ERR] Error during customer self-registration: nghiadaucau1@gmail.com {"SourceContext":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController","ActionId":"b67081e8-d554-4ca2-8cf2-c534ad10e6aa","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFVD4PEH7CA:0000000B","RequestPath":"/api/customer/register","ConnectionId":"0HNFVD4PEH7CA"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (CUS000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:d1eeca01-d8e9-4753-8e90-82c4da3d572f
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerAccountService.CreateCustomerWithAccountAsync(CreateCustomerRequestDto customerRequest, String password) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerAccountService.cs:line 107
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerAccountService.CreateCustomerWithAccountAsync(CreateCustomerRequestDto customerRequest, String password) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerAccountService.cs:line 139
   at EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer(CustomerRegistrationDto request) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API\Controllers\Customers\CustomerRegistrationController.cs:line 65
[2025-09-29 22:09:47.071 +07:00 INF] Now listening on: https://localhost:7077 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 22:09:47.118 +07:00 INF] Now listening on: http://localhost:5153 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 22:09:47.170 +07:00 INF] Application started. Press Ctrl+C to shut down. {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 22:09:47.175 +07:00 INF] Hosting environment: Development {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 22:09:47.178 +07:00 INF] Content root path: C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 22:09:47.671 +07:00 INF] Request: GET / {"SourceContext":"Program","RequestId":"0HNFVD8TAEA6R:00000001","RequestPath":"/","ConnectionId":"0HNFVD8TAEA6R"}
[2025-09-29 22:10:00.706 +07:00 INF] Request: POST /api/customer/register {"SourceContext":"Program","RequestId":"0HNFVD8TAEA6R:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFVD8TAEA6R"}
[2025-09-29 22:11:23.163 +07:00 WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'. {"EventId":{"Id":30004,"Name":"Microsoft.EntityFrameworkCore.Database.Transaction.SavepointsDisabledBecauseOfMARS"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Transaction","ActionId":"e89a2289-1d81-44a9-8a59-61e87ce88abc","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFVD8TAEA6R:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFVD8TAEA6R"}
[2025-09-29 22:11:26.821 +07:00 INF] Email sent successfully to nghiadaucau1@gmail.com with subject: Xác thực tài khoản EV Service Center {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.EmailService","ActionId":"e89a2289-1d81-44a9-8a59-61e87ce88abc","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFVD8TAEA6R:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFVD8TAEA6R"}
[2025-09-29 22:11:26.840 +07:00 INF] Verification email sent to customer nghiadaucau1@gmail.com for user nghiadaucau1@gmail.com {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"e89a2289-1d81-44a9-8a59-61e87ce88abc","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFVD8TAEA6R:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFVD8TAEA6R"}
[2025-09-29 22:11:26.850 +07:00 INF] Customer user registered successfully: nghiadaucau1@gmail.com, Email: nghiadaucau1@gmail.com {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"e89a2289-1d81-44a9-8a59-61e87ce88abc","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFVD8TAEA6R:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFVD8TAEA6R"}
[2025-09-29 22:11:45.297 +07:00 WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'. {"EventId":{"Id":30004,"Name":"Microsoft.EntityFrameworkCore.Database.Transaction.SavepointsDisabledBecauseOfMARS"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Transaction","ActionId":"e89a2289-1d81-44a9-8a59-61e87ce88abc","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFVD8TAEA6R:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFVD8TAEA6R"}
[2025-09-29 22:11:45.355 +07:00 ERR] An exception occurred in the database while saving changes for context type 'EVServiceCenter.Core.Entities.EVDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (CUS000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c2b64ebb-126d-4c65-b468-ffaf4dff4ff1
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken) {"EventId":{"Id":10000,"Name":"Microsoft.EntityFrameworkCore.Update.SaveChangesFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Update","ActionId":"e89a2289-1d81-44a9-8a59-61e87ce88abc","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFVD8TAEA6R:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFVD8TAEA6R"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (CUS000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c2b64ebb-126d-4c65-b468-ffaf4dff4ff1
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
[2025-09-29 22:12:27.642 +07:00 ERR] Error creating customer with account: NghiaPham {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerAccountService","ActionId":"e89a2289-1d81-44a9-8a59-61e87ce88abc","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFVD8TAEA6R:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFVD8TAEA6R"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (CUS000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c2b64ebb-126d-4c65-b468-ffaf4dff4ff1
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerAccountService.CreateCustomerWithAccountAsync(CreateCustomerRequestDto customerRequest, String password) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerAccountService.cs:line 107
[2025-09-29 22:12:28.517 +07:00 ERR] Error during customer self-registration: nghiadaucau1@gmail.com {"SourceContext":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController","ActionId":"e89a2289-1d81-44a9-8a59-61e87ce88abc","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFVD8TAEA6R:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFVD8TAEA6R"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (CUS000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c2b64ebb-126d-4c65-b468-ffaf4dff4ff1
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerAccountService.CreateCustomerWithAccountAsync(CreateCustomerRequestDto customerRequest, String password) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerAccountService.cs:line 107
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerAccountService.CreateCustomerWithAccountAsync(CreateCustomerRequestDto customerRequest, String password) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerAccountService.cs:line 139
   at EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer(CustomerRegistrationDto request) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API\Controllers\Customers\CustomerRegistrationController.cs:line 65
[2025-09-29 22:14:54.540 +07:00 INF] Now listening on: https://localhost:7077 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 22:14:54.695 +07:00 INF] Now listening on: http://localhost:5153 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 22:14:54.821 +07:00 INF] Application started. Press Ctrl+C to shut down. {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 22:14:54.828 +07:00 INF] Hosting environment: Development {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 22:14:54.833 +07:00 INF] Content root path: C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 22:14:55.209 +07:00 INF] Request: GET / {"SourceContext":"Program","RequestId":"0HNFVDBOURHH1:00000001","RequestPath":"/","ConnectionId":"0HNFVDBOURHH1"}
[2025-09-29 22:15:06.062 +07:00 INF] Request: POST /api/customer/register {"SourceContext":"Program","RequestId":"0HNFVDBOURHH1:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFVDBOURHH1"}
[2025-09-29 22:15:15.079 +07:00 WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'. {"EventId":{"Id":30004,"Name":"Microsoft.EntityFrameworkCore.Database.Transaction.SavepointsDisabledBecauseOfMARS"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Transaction","ActionId":"b2bd1238-29f3-418c-a50d-f11ad1c8750b","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFVDBOURHH1:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFVDBOURHH1"}
[2025-09-29 22:15:19.032 +07:00 INF] Email sent successfully to nghiadaucau1@gmail.com with subject: Xác thực tài khoản EV Service Center {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.EmailService","ActionId":"b2bd1238-29f3-418c-a50d-f11ad1c8750b","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFVDBOURHH1:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFVDBOURHH1"}
[2025-09-29 22:15:19.065 +07:00 INF] Verification email sent to customer nghiadaucau1@gmail.com for user nghiadaucau1@gmail.com {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"b2bd1238-29f3-418c-a50d-f11ad1c8750b","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFVDBOURHH1:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFVDBOURHH1"}
[2025-09-29 22:15:19.087 +07:00 INF] Customer user registered successfully: nghiadaucau1@gmail.com, Email: nghiadaucau1@gmail.com {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"b2bd1238-29f3-418c-a50d-f11ad1c8750b","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFVDBOURHH1:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFVDBOURHH1"}
[2025-09-29 22:15:19.271 +07:00 WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'. {"EventId":{"Id":30004,"Name":"Microsoft.EntityFrameworkCore.Database.Transaction.SavepointsDisabledBecauseOfMARS"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Transaction","ActionId":"b2bd1238-29f3-418c-a50d-f11ad1c8750b","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFVDBOURHH1:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFVDBOURHH1"}
[2025-09-29 22:15:19.332 +07:00 INF] Created customer with account: KH2509004 - NghiaPham - UserID: 2067 {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerAccountService","ActionId":"b2bd1238-29f3-418c-a50d-f11ad1c8750b","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFVDBOURHH1:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFVDBOURHH1"}
[2025-09-29 22:15:19.363 +07:00 INF] Customer self-registered: KH2509004 - NghiaPham - nghiadaucau1@gmail.com {"SourceContext":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController","ActionId":"b2bd1238-29f3-418c-a50d-f11ad1c8750b","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFVDBOURHH1:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFVDBOURHH1"}
[2025-09-29 22:16:48.342 +07:00 INF] Request: POST /api/verification/verify-email {"SourceContext":"Program","RequestId":"0HNFVDBOURHH2:00000001","RequestPath":"/api/verification/verify-email","ConnectionId":"0HNFVDBOURHH2"}
[2025-09-29 22:16:48.572 +07:00 WRN] Invalid or expired verification token for: nghiadaucau1@gmail.com {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"cafc149c-f6f2-4533-94d9-1ce6ac39219e","ActionName":"EVServiceCenter.API.Controllers.Auth.VerificationController.VerifyEmail (EVServiceCenter.API)","RequestId":"0HNFVDBOURHH2:00000001","RequestPath":"/api/verification/verify-email","ConnectionId":"0HNFVDBOURHH2"}
[2025-09-29 22:17:21.247 +07:00 INF] Request: GET /api/verification/verify-email {"SourceContext":"Program","RequestId":"0HNFVDBOURHH2:00000003","RequestPath":"/api/verification/verify-email","ConnectionId":"0HNFVDBOURHH2"}
[2025-09-29 22:17:21.295 +07:00 INF] Processing email verification for nghiadaucau1@gmail.com {"SourceContext":"EVServiceCenter.API.Controllers.Auth.VerificationController","ActionId":"2d72a88c-caf3-4de2-8c3a-b6b1b2160709","ActionName":"EVServiceCenter.API.Controllers.Auth.VerificationController.VerifyEmailFromLink (EVServiceCenter.API)","RequestId":"0HNFVDBOURHH2:00000003","RequestPath":"/api/verification/verify-email","ConnectionId":"0HNFVDBOURHH2"}
[2025-09-29 22:17:21.325 +07:00 WRN] Invalid or expired verification token for: nghiadaucau1@gmail.com {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"2d72a88c-caf3-4de2-8c3a-b6b1b2160709","ActionName":"EVServiceCenter.API.Controllers.Auth.VerificationController.VerifyEmailFromLink (EVServiceCenter.API)","RequestId":"0HNFVDBOURHH2:00000003","RequestPath":"/api/verification/verify-email","ConnectionId":"0HNFVDBOURHH2"}
[2025-09-29 22:17:21.344 +07:00 WRN] Email verification failed for nghiadaucau1@gmail.com {"SourceContext":"EVServiceCenter.API.Controllers.Auth.VerificationController","ActionId":"2d72a88c-caf3-4de2-8c3a-b6b1b2160709","ActionName":"EVServiceCenter.API.Controllers.Auth.VerificationController.VerifyEmailFromLink (EVServiceCenter.API)","RequestId":"0HNFVDBOURHH2:00000003","RequestPath":"/api/verification/verify-email","ConnectionId":"0HNFVDBOURHH2"}
[2025-09-29 22:18:36.483 +07:00 INF] Request: POST /api/verification/verify-email {"SourceContext":"Program","RequestId":"0HNFVDBOURHH3:00000001","RequestPath":"/api/verification/verify-email","ConnectionId":"0HNFVDBOURHH3"}
[2025-09-29 22:18:36.550 +07:00 WRN] Invalid or expired verification token for: nghiadaucau1@gmail.com {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"cafc149c-f6f2-4533-94d9-1ce6ac39219e","ActionName":"EVServiceCenter.API.Controllers.Auth.VerificationController.VerifyEmail (EVServiceCenter.API)","RequestId":"0HNFVDBOURHH3:00000001","RequestPath":"/api/verification/verify-email","ConnectionId":"0HNFVDBOURHH3"}
[2025-09-29 22:19:50.970 +07:00 INF] Request: POST /api/verification/verify-email {"SourceContext":"Program","RequestId":"0HNFVDBOURHH3:00000003","RequestPath":"/api/verification/verify-email","ConnectionId":"0HNFVDBOURHH3"}
[2025-09-29 22:19:54.442 +07:00 INF] Email sent successfully to nghiadaucau1@gmail.com with subject: Chào mừng đến với EV Service Center {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.EmailService","ActionId":"cafc149c-f6f2-4533-94d9-1ce6ac39219e","ActionName":"EVServiceCenter.API.Controllers.Auth.VerificationController.VerifyEmail (EVServiceCenter.API)","RequestId":"0HNFVDBOURHH3:00000003","RequestPath":"/api/verification/verify-email","ConnectionId":"0HNFVDBOURHH3"}
[2025-09-29 22:19:54.473 +07:00 INF] Email verified successfully for user: nghiadaucau1@gmail.com {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"cafc149c-f6f2-4533-94d9-1ce6ac39219e","ActionName":"EVServiceCenter.API.Controllers.Auth.VerificationController.VerifyEmail (EVServiceCenter.API)","RequestId":"0HNFVDBOURHH3:00000003","RequestPath":"/api/verification/verify-email","ConnectionId":"0HNFVDBOURHH3"}
[2025-09-29 22:21:14.131 +07:00 INF] Request: POST /api/auth/login {"SourceContext":"Program","RequestId":"0HNFVDBOURHH3:00000005","RequestPath":"/api/auth/login","ConnectionId":"0HNFVDBOURHH3"}
[2025-09-29 22:21:15.163 +07:00 WRN] Invalid password for user nghiadaucau1@gmail.com. Failed attempts: 1 {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"821e25ad-7b13-4bec-9e85-96f2916145d2","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Login (EVServiceCenter.API)","RequestId":"0HNFVDBOURHH3:00000005","RequestPath":"/api/auth/login","ConnectionId":"0HNFVDBOURHH3"}
[2025-09-29 22:22:21.887 +07:00 INF] Request: POST /api/auth/login {"SourceContext":"Program","RequestId":"0HNFVDBOURHH3:00000007","RequestPath":"/api/auth/login","ConnectionId":"0HNFVDBOURHH3"}
[2025-09-29 22:22:22.246 +07:00 WRN] Invalid password for user nghiadaucau1@gmail.com. Failed attempts: 2 {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"821e25ad-7b13-4bec-9e85-96f2916145d2","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Login (EVServiceCenter.API)","RequestId":"0HNFVDBOURHH3:00000007","RequestPath":"/api/auth/login","ConnectionId":"0HNFVDBOURHH3"}
[2025-09-29 22:23:24.514 +07:00 INF] Request: POST /api/auth/login {"SourceContext":"Program","RequestId":"0HNFVDBOURHH3:00000009","RequestPath":"/api/auth/login","ConnectionId":"0HNFVDBOURHH3"}
[2025-09-29 22:23:24.919 +07:00 INF] User nghiadaucau1@gmail.com (ID: 2067, Role: "Customer") logged in successfully from IP: 127.0.0.1, UserAgent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36 Edg/140.0.0.0 {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"821e25ad-7b13-4bec-9e85-96f2916145d2","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Login (EVServiceCenter.API)","RequestId":"0HNFVDBOURHH3:00000009","RequestPath":"/api/auth/login","ConnectionId":"0HNFVDBOURHH3"}
[2025-09-29 22:24:40.043 +07:00 INF] Request: GET /api/auth/profile {"SourceContext":"Program","RequestId":"0HNFVDBOURHH3:0000000B","RequestPath":"/api/auth/profile","ConnectionId":"0HNFVDBOURHH3"}
[2025-09-29 22:25:01.745 +07:00 INF] Request: GET /api/customers {"SourceContext":"Program","RequestId":"0HNFVDBOURHH3:0000000D","RequestPath":"/api/customers","ConnectionId":"0HNFVDBOURHH3"}
[2025-09-29 22:25:06.682 +07:00 INF] Request: GET /api/customer/profile/me {"SourceContext":"Program","RequestId":"0HNFVDBOURHH3:0000000F","RequestPath":"/api/customer/profile/me","ConnectionId":"0HNFVDBOURHH3"}
[2025-09-29 22:43:10.576 +07:00 INF] Now listening on: https://localhost:7077 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 22:43:10.646 +07:00 INF] Now listening on: http://localhost:5153 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 22:43:10.714 +07:00 INF] Application started. Press Ctrl+C to shut down. {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 22:43:10.721 +07:00 INF] Hosting environment: Development {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 22:43:10.729 +07:00 INF] Content root path: C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 22:43:11.067 +07:00 INF] Request: GET / {"SourceContext":"Program","RequestId":"0HNFVDRIC67NJ:00000001","RequestPath":"/","ConnectionId":"0HNFVDRIC67NJ"}
[2025-09-29 22:43:43.047 +07:00 INF] Request: POST /api/auth/login {"SourceContext":"Program","RequestId":"0HNFVDRIC67NJ:00000009","RequestPath":"/api/auth/login","ConnectionId":"0HNFVDRIC67NJ"}
[2025-09-29 22:43:48.764 +07:00 INF] User nghiadaucau1@gmail.com (ID: 2067, Role: "Customer") logged in successfully from IP: 127.0.0.1, UserAgent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36 Edg/140.0.0.0 {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"d480c11a-b817-4814-aa4e-231c684bace9","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Login (EVServiceCenter.API)","RequestId":"0HNFVDRIC67NJ:00000009","RequestPath":"/api/auth/login","ConnectionId":"0HNFVDRIC67NJ"}
[2025-09-29 22:44:10.533 +07:00 INF] Request: GET /api/customer/profile/me {"SourceContext":"Program","RequestId":"0HNFVDRIC67NJ:0000000B","RequestPath":"/api/customer/profile/me","ConnectionId":"0HNFVDRIC67NJ"}
[2025-09-29 22:45:03.973 +07:00 INF] Request: PUT /api/customer/profile/me {"SourceContext":"Program","RequestId":"0HNFVDRIC67NJ:0000000D","RequestPath":"/api/customer/profile/me","ConnectionId":"0HNFVDRIC67NJ"}
[2025-09-29 22:45:04.453 +07:00 WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'. {"EventId":{"Id":30004,"Name":"Microsoft.EntityFrameworkCore.Database.Transaction.SavepointsDisabledBecauseOfMARS"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Transaction","ActionId":"d811d04c-d2b2-4906-89a5-495007ed693f","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerProfileController.UpdateMyProfile (EVServiceCenter.API)","RequestId":"0HNFVDRIC67NJ:0000000D","RequestPath":"/api/customer/profile/me","ConnectionId":"0HNFVDRIC67NJ"}
[2025-09-29 22:45:04.515 +07:00 INF] Updated customer: KH2509004 - NghiaPham {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Repositories.CustomerRepository","ActionId":"d811d04c-d2b2-4906-89a5-495007ed693f","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerProfileController.UpdateMyProfile (EVServiceCenter.API)","RequestId":"0HNFVDRIC67NJ:0000000D","RequestPath":"/api/customer/profile/me","ConnectionId":"0HNFVDRIC67NJ"}
[2025-09-29 22:45:04.553 +07:00 INF] Successfully updated customer: KH2509004 - NghiaPham {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerService","ActionId":"d811d04c-d2b2-4906-89a5-495007ed693f","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerProfileController.UpdateMyProfile (EVServiceCenter.API)","RequestId":"0HNFVDRIC67NJ:0000000D","RequestPath":"/api/customer/profile/me","ConnectionId":"0HNFVDRIC67NJ"}
[2025-09-29 22:45:04.580 +07:00 INF] Customer 1014 updated own profile {"SourceContext":"EVServiceCenter.API.Controllers.Customers.CustomerProfileController","ActionId":"d811d04c-d2b2-4906-89a5-495007ed693f","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerProfileController.UpdateMyProfile (EVServiceCenter.API)","RequestId":"0HNFVDRIC67NJ:0000000D","RequestPath":"/api/customer/profile/me","ConnectionId":"0HNFVDRIC67NJ"}
[2025-09-29 22:50:28.006 +07:00 INF] Now listening on: https://localhost:7077 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 22:50:28.072 +07:00 INF] Now listening on: http://localhost:5153 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 22:50:28.137 +07:00 INF] Application started. Press Ctrl+C to shut down. {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 22:50:28.191 +07:00 INF] Hosting environment: Development {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 22:50:28.197 +07:00 INF] Content root path: C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-29 22:50:28.678 +07:00 INF] Request: GET / {"SourceContext":"Program","RequestId":"0HNFVDVKPK118:00000001","RequestPath":"/","ConnectionId":"0HNFVDVKPK118"}
[2025-09-29 22:50:44.257 +07:00 INF] Request: POST /api/auth/login {"SourceContext":"Program","RequestId":"0HNFVDVKPK119:00000007","RequestPath":"/api/auth/login","ConnectionId":"0HNFVDVKPK119"}
[2025-09-29 22:50:50.002 +07:00 INF] User NghiaPham (ID: 8, Role: "Admin") logged in successfully from IP: 127.0.0.1, UserAgent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36 Edg/140.0.0.0 {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"b8420c1b-bb9f-46f0-81e0-6dce5df213ee","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Login (EVServiceCenter.API)","RequestId":"0HNFVDVKPK119:00000007","RequestPath":"/api/auth/login","ConnectionId":"0HNFVDVKPK119"}
[2025-09-29 22:50:53.642 +07:00 INF] Email sent successfully to admin01@evservice.com with subject: Thông báo đăng nhập {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.EmailService","ActionId":"b8420c1b-bb9f-46f0-81e0-6dce5df213ee","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Login (EVServiceCenter.API)","RequestId":"0HNFVDVKPK119:00000007","RequestPath":"/api/auth/login","ConnectionId":"0HNFVDVKPK119"}
[2025-09-29 22:51:16.851 +07:00 INF] Request: GET /api/auth/profile {"SourceContext":"Program","RequestId":"0HNFVDVKPK119:00000009","RequestPath":"/api/auth/profile","ConnectionId":"0HNFVDVKPK119"}
[2025-09-29 22:51:25.024 +07:00 INF] Request: GET /api/users {"SourceContext":"Program","RequestId":"0HNFVDVKPK119:0000000B","RequestPath":"/api/users","ConnectionId":"0HNFVDVKPK119"}
[2025-09-29 22:51:37.342 +07:00 INF] Request: DELETE /api/users/2067 {"SourceContext":"Program","RequestId":"0HNFVDVKPK119:0000000D","RequestPath":"/api/users/2067","ConnectionId":"0HNFVDVKPK119"}
[2025-09-29 22:51:37.822 +07:00 ERR] An exception occurred in the database while saving changes for context type 'EVServiceCenter.Core.Entities.EVDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The DELETE statement conflicted with the REFERENCE constraint "FK_Customers_Users". The conflict occurred in database "EVServiceCenterV2", table "dbo.Customers", column 'UserID'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetWithRowsAffectedOnlyAsync(Int32 commandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:7f8febc6-4c73-45e0-bb5f-a26d86001c8b
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken) {"EventId":{"Id":10000,"Name":"Microsoft.EntityFrameworkCore.Update.SaveChangesFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Update","ActionId":"06cd9442-18b9-4a22-b129-75c020c7651e","ActionName":"EVServiceCenter.API.Controllers.Users.UserController.DeleteUser (EVServiceCenter.API)","RequestId":"0HNFVDVKPK119:0000000D","RequestPath":"/api/users/2067","ConnectionId":"0HNFVDVKPK119"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The DELETE statement conflicted with the REFERENCE constraint "FK_Customers_Users". The conflict occurred in database "EVServiceCenterV2", table "dbo.Customers", column 'UserID'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetWithRowsAffectedOnlyAsync(Int32 commandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:7f8febc6-4c73-45e0-bb5f-a26d86001c8b
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
[2025-09-29 22:51:38.633 +07:00 ERR] Error deleting user 2067 {"SourceContext":"EVServiceCenter.API.Controllers.Users.UserController","ActionId":"06cd9442-18b9-4a22-b129-75c020c7651e","ActionName":"EVServiceCenter.API.Controllers.Users.UserController.DeleteUser (EVServiceCenter.API)","RequestId":"0HNFVDVKPK119:0000000D","RequestPath":"/api/users/2067","ConnectionId":"0HNFVDVKPK119"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The DELETE statement conflicted with the REFERENCE constraint "FK_Customers_Users". The conflict occurred in database "EVServiceCenterV2", table "dbo.Customers", column 'UserID'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetWithRowsAffectedOnlyAsync(Int32 commandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:7f8febc6-4c73-45e0-bb5f-a26d86001c8b
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Shared.Repositories.Repository`1.DeleteAsync(Int32 id) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Shared\Repositories\Repository.cs:line 51
   at EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService.DeleteUserAsync(Int32 userId) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Identity\Services\UserService.cs:line 480
   at EVServiceCenter.API.Controllers.Users.UserController.DeleteUser(Int32 id) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API\Controllers\Users\UserController.cs:line 186
[2025-09-29 22:51:54.313 +07:00 INF] Request: GET /api/users {"SourceContext":"Program","RequestId":"0HNFVDVKPK119:0000000F","RequestPath":"/api/users","ConnectionId":"0HNFVDVKPK119"}
[2025-09-29 22:52:01.219 +07:00 INF] Request: DELETE /api/users/3 {"SourceContext":"Program","RequestId":"0HNFVDVKPK119:00000011","RequestPath":"/api/users/3","ConnectionId":"0HNFVDVKPK119"}
[2025-09-29 22:52:23.707 +07:00 INF] Request: GET /api/verification/email-status/nghiadaucau1@gmail.com {"SourceContext":"Program","RequestId":"0HNFVDVKPK119:00000013","RequestPath":"/api/verification/email-status/nghiadaucau1@gmail.com","ConnectionId":"0HNFVDVKPK119"}
