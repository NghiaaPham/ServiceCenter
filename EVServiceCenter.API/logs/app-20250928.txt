[2025-09-28 12:14:27.019 +07:00 INF] Now listening on: https://localhost:7077 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 12:14:27.073 +07:00 INF] Now listening on: http://localhost:5153 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 12:14:27.130 +07:00 INF] Application started. Press Ctrl+C to shut down. {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 12:14:27.162 +07:00 INF] Hosting environment: Development {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 12:14:27.168 +07:00 INF] Content root path: C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 12:14:27.667 +07:00 INF] Request: GET / {"SourceContext":"Program","RequestId":"0HNFU9NILB23K:00000001","RequestPath":"/","ConnectionId":"0HNFU9NILB23K"}
[2025-09-28 12:15:33.301 +07:00 INF] Request: POST /api/auth/register {"SourceContext":"Program","RequestId":"0HNFU9NILB23L:00000017","RequestPath":"/api/auth/register","ConnectionId":"0HNFU9NILB23L"}
[2025-09-28 12:15:57.322 +07:00 INF] Request: POST /api/auth/login {"SourceContext":"Program","RequestId":"0HNFU9NILB23L:00000019","RequestPath":"/api/auth/login","ConnectionId":"0HNFU9NILB23L"}
[2025-09-28 12:16:05.532 +07:00 INF] User NghiaPham (ID: 8, Role: "Admin") logged in successfully from IP: 127.0.0.1, UserAgent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36 Edg/140.0.0.0 {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"8e59be67-4896-4a21-9493-6906b6517092","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Login (EVServiceCenter.API)","RequestId":"0HNFU9NILB23L:00000019","RequestPath":"/api/auth/login","ConnectionId":"0HNFU9NILB23L"}
[2025-09-28 12:16:10.906 +07:00 INF] Email sent successfully to admin01@evservice.com with subject: Thông báo đăng nhập {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.EmailService","ActionId":"8e59be67-4896-4a21-9493-6906b6517092","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Login (EVServiceCenter.API)","RequestId":"0HNFU9NILB23L:00000019","RequestPath":"/api/auth/login","ConnectionId":"0HNFU9NILB23L"}
[2025-09-28 12:16:30.119 +07:00 INF] Request: GET /api/auth/profile {"SourceContext":"Program","RequestId":"0HNFU9NILB23L:0000001B","RequestPath":"/api/auth/profile","ConnectionId":"0HNFU9NILB23L"}
[2025-09-28 12:16:40.634 +07:00 INF] Request: POST /api/auth/register {"SourceContext":"Program","RequestId":"0HNFU9NILB23L:0000001D","RequestPath":"/api/auth/register","ConnectionId":"0HNFU9NILB23L"}
[2025-09-28 12:16:41.211 +07:00 ERR] Error during internal user registration {"SourceContext":"EVServiceCenter.API.Controllers.Auth.AuthController","ActionId":"05c9d29d-45da-4f30-b811-38330670a189","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Register (EVServiceCenter.API)","RequestId":"0HNFU9NILB23L:0000001D","RequestPath":"/api/auth/register","ConnectionId":"0HNFU9NILB23L"}
System.InvalidOperationException: Tên đăng nhập đã tồn tại
   at EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService.RegisterUserAsync(User user, String plainPassword) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Identity\Services\UserService.cs:line 63
   at EVServiceCenter.API.Controllers.Auth.AuthController.Register(RegisterRequestDto registerRequest) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API\Controllers\Auth\AuthController.cs:line 71
[2025-09-28 12:17:13.988 +07:00 INF] Request: POST /api/auth/register {"SourceContext":"Program","RequestId":"0HNFU9NILB23L:0000001F","RequestPath":"/api/auth/register","ConnectionId":"0HNFU9NILB23L"}
[2025-09-28 12:17:19.280 +07:00 INF] Email sent successfully to alice.nguyen@evservice.vn with subject: Xác thực tài khoản EV Service Center {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.EmailService","ActionId":"05c9d29d-45da-4f30-b811-38330670a189","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Register (EVServiceCenter.API)","RequestId":"0HNFU9NILB23L:0000001F","RequestPath":"/api/auth/register","ConnectionId":"0HNFU9NILB23L"}
[2025-09-28 12:17:19.307 +07:00 INF] Verification email sent to alice.nguyen@evservice.vn for user alice.nguyen {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"05c9d29d-45da-4f30-b811-38330670a189","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Register (EVServiceCenter.API)","RequestId":"0HNFU9NILB23L:0000001F","RequestPath":"/api/auth/register","ConnectionId":"0HNFU9NILB23L"}
[2025-09-28 12:17:19.321 +07:00 INF] User registered successfully: alice.nguyen, Role: "Technician" {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"05c9d29d-45da-4f30-b811-38330670a189","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Register (EVServiceCenter.API)","RequestId":"0HNFU9NILB23L:0000001F","RequestPath":"/api/auth/register","ConnectionId":"0HNFU9NILB23L"}
[2025-09-28 12:18:58.519 +07:00 INF] Request: POST /api/auth/login {"SourceContext":"Program","RequestId":"0HNFU9NILB23L:00000021","RequestPath":"/api/auth/login","ConnectionId":"0HNFU9NILB23L"}
[2025-09-28 12:19:10.652 +07:00 INF] Request: POST /api/auth/login {"SourceContext":"Program","RequestId":"0HNFU9NILB23L:00000023","RequestPath":"/api/auth/login","ConnectionId":"0HNFU9NILB23L"}
[2025-09-28 12:19:11.212 +07:00 WRN] Login blocked: Email not verified for alice.nguyen {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"8e59be67-4896-4a21-9493-6906b6517092","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Login (EVServiceCenter.API)","RequestId":"0HNFU9NILB23L:00000023","RequestPath":"/api/auth/login","ConnectionId":"0HNFU9NILB23L"}
[2025-09-28 13:07:55.128 +07:00 INF] Now listening on: https://localhost:7077 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 13:07:55.209 +07:00 INF] Now listening on: http://localhost:5153 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 13:07:55.284 +07:00 INF] Application started. Press Ctrl+C to shut down. {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 13:07:55.293 +07:00 INF] Hosting environment: Development {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 13:07:55.302 +07:00 INF] Content root path: C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 13:07:55.959 +07:00 INF] Request: GET / {"SourceContext":"Program","RequestId":"0HNFUALERLV5V:00000001","RequestPath":"/","ConnectionId":"0HNFUALERLV5V"}
[2025-09-28 13:08:16.813 +07:00 INF] Request: POST /api/auth/login {"SourceContext":"Program","RequestId":"0HNFUALERLV5V:00000009","RequestPath":"/api/auth/login","ConnectionId":"0HNFUALERLV5V"}
[2025-09-28 13:08:23.336 +07:00 INF] User NghiaPham (ID: 8, Role: "Admin") logged in successfully from IP: 127.0.0.1, UserAgent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36 Edg/140.0.0.0 {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"6293127b-894f-420b-94f7-8ae121bd0eef","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Login (EVServiceCenter.API)","RequestId":"0HNFUALERLV5V:00000009","RequestPath":"/api/auth/login","ConnectionId":"0HNFUALERLV5V"}
[2025-09-28 13:08:27.935 +07:00 INF] Email sent successfully to admin01@evservice.com with subject: Thông báo đăng nhập {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.EmailService","ActionId":"6293127b-894f-420b-94f7-8ae121bd0eef","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Login (EVServiceCenter.API)","RequestId":"0HNFUALERLV5V:00000009","RequestPath":"/api/auth/login","ConnectionId":"0HNFUALERLV5V"}
[2025-09-28 13:09:22.027 +07:00 INF] Request: POST /api/auth/register {"SourceContext":"Program","RequestId":"0HNFUALERLV5V:0000000B","RequestPath":"/api/auth/register","ConnectionId":"0HNFUALERLV5V"}
[2025-09-28 13:09:38.324 +07:00 INF] Request: POST /api/auth/register {"SourceContext":"Program","RequestId":"0HNFUALERLV5V:0000000D","RequestPath":"/api/auth/register","ConnectionId":"0HNFUALERLV5V"}
[2025-09-28 13:09:43.483 +07:00 INF] Email sent successfully to staffa@company.com with subject: Chào mừng gia nhập đội ngũ EV Service Center {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.EmailService","ActionId":"798d64fe-1f04-451b-8dd4-5f11e51601f1","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Register (EVServiceCenter.API)","RequestId":"0HNFUALERLV5V:0000000D","RequestPath":"/api/auth/register","ConnectionId":"0HNFUALERLV5V"}
[2025-09-28 13:09:43.502 +07:00 INF] Welcome email sent to internal staff staffa@company.com for user staff001 {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"798d64fe-1f04-451b-8dd4-5f11e51601f1","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Register (EVServiceCenter.API)","RequestId":"0HNFUALERLV5V:0000000D","RequestPath":"/api/auth/register","ConnectionId":"0HNFUALERLV5V"}
[2025-09-28 13:09:43.540 +07:00 INF] Internal staff registered successfully: staff001, Role: "Staff", EmployeeCode: EMP-25-0004 {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"798d64fe-1f04-451b-8dd4-5f11e51601f1","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Register (EVServiceCenter.API)","RequestId":"0HNFUALERLV5V:0000000D","RequestPath":"/api/auth/register","ConnectionId":"0HNFUALERLV5V"}
[2025-09-28 13:12:33.999 +07:00 INF] Request: POST /api/auth/register {"SourceContext":"Program","RequestId":"0HNFUALERLV5V:0000000F","RequestPath":"/api/auth/register","ConnectionId":"0HNFUALERLV5V"}
[2025-09-28 13:12:38.171 +07:00 INF] Email sent successfully to nghiadaucau1@gmail.com with subject: Chào mừng gia nhập đội ngũ EV Service Center {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.EmailService","ActionId":"798d64fe-1f04-451b-8dd4-5f11e51601f1","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Register (EVServiceCenter.API)","RequestId":"0HNFUALERLV5V:0000000F","RequestPath":"/api/auth/register","ConnectionId":"0HNFUALERLV5V"}
[2025-09-28 13:12:38.204 +07:00 INF] Welcome email sent to internal staff nghiadaucau1@gmail.com for user staff002 {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"798d64fe-1f04-451b-8dd4-5f11e51601f1","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Register (EVServiceCenter.API)","RequestId":"0HNFUALERLV5V:0000000F","RequestPath":"/api/auth/register","ConnectionId":"0HNFUALERLV5V"}
[2025-09-28 13:12:38.214 +07:00 INF] Internal staff registered successfully: staff002, Role: "Staff", EmployeeCode: EMP-25-0005 {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"798d64fe-1f04-451b-8dd4-5f11e51601f1","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Register (EVServiceCenter.API)","RequestId":"0HNFUALERLV5V:0000000F","RequestPath":"/api/auth/register","ConnectionId":"0HNFUALERLV5V"}
[2025-09-28 13:23:43.475 +07:00 INF] Now listening on: https://localhost:7077 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 13:23:43.528 +07:00 INF] Now listening on: http://localhost:5153 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 13:23:43.588 +07:00 INF] Application started. Press Ctrl+C to shut down. {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 13:23:43.595 +07:00 INF] Hosting environment: Development {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 13:23:43.603 +07:00 INF] Content root path: C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 13:23:44.176 +07:00 INF] Request: GET / {"SourceContext":"Program","RequestId":"0HNFUAU9EP7JO:00000001","RequestPath":"/","ConnectionId":"0HNFUAU9EP7JO"}
[2025-09-28 13:24:08.531 +07:00 INF] Request: POST /api/auth/login {"SourceContext":"Program","RequestId":"0HNFUAU9EP7JO:00000009","RequestPath":"/api/auth/login","ConnectionId":"0HNFUAU9EP7JO"}
[2025-09-28 13:24:15.345 +07:00 INF] User NghiaPham (ID: 8, Role: "Admin") logged in successfully from IP: 127.0.0.1, UserAgent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36 Edg/140.0.0.0 {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"e5291ef7-c9a8-425a-868a-42d714771de2","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Login (EVServiceCenter.API)","RequestId":"0HNFUAU9EP7JO:00000009","RequestPath":"/api/auth/login","ConnectionId":"0HNFUAU9EP7JO"}
[2025-09-28 13:24:19.060 +07:00 INF] Email sent successfully to admin01@evservice.com with subject: Thông báo đăng nhập {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.EmailService","ActionId":"e5291ef7-c9a8-425a-868a-42d714771de2","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Login (EVServiceCenter.API)","RequestId":"0HNFUAU9EP7JO:00000009","RequestPath":"/api/auth/login","ConnectionId":"0HNFUAU9EP7JO"}
[2025-09-28 13:25:37.061 +07:00 INF] Request: POST /api/auth/register {"SourceContext":"Program","RequestId":"0HNFUAU9EP7JO:0000000B","RequestPath":"/api/auth/register","ConnectionId":"0HNFUAU9EP7JO"}
[2025-09-28 13:25:42.066 +07:00 INF] Email sent successfully to nghiadaucau1@gmail.com with subject: Chào mừng gia nhập đội ngũ EV Service Center {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.EmailService","ActionId":"02864230-0b8b-44cf-9186-c7ff7d3cf347","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Register (EVServiceCenter.API)","RequestId":"0HNFUAU9EP7JO:0000000B","RequestPath":"/api/auth/register","ConnectionId":"0HNFUAU9EP7JO"}
[2025-09-28 13:25:42.090 +07:00 INF] Welcome email sent to internal staff nghiadaucau1@gmail.com for user staff002 {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"02864230-0b8b-44cf-9186-c7ff7d3cf347","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Register (EVServiceCenter.API)","RequestId":"0HNFUAU9EP7JO:0000000B","RequestPath":"/api/auth/register","ConnectionId":"0HNFUAU9EP7JO"}
[2025-09-28 13:25:42.101 +07:00 INF] Internal staff registered successfully: staff002, Role: "Staff", EmployeeCode: EMP-25-0005 {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"02864230-0b8b-44cf-9186-c7ff7d3cf347","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Register (EVServiceCenter.API)","RequestId":"0HNFUAU9EP7JO:0000000B","RequestPath":"/api/auth/register","ConnectionId":"0HNFUAU9EP7JO"}
[2025-09-28 13:27:31.301 +07:00 INF] Now listening on: https://localhost:7077 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 13:27:31.342 +07:00 INF] Now listening on: http://localhost:5153 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 13:27:31.391 +07:00 INF] Application started. Press Ctrl+C to shut down. {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 13:27:31.430 +07:00 INF] Hosting environment: Development {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 13:27:31.445 +07:00 INF] Content root path: C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 13:27:31.912 +07:00 INF] Request: GET / {"SourceContext":"Program","RequestId":"0HNFUB0DAEGRC:00000001","RequestPath":"/","ConnectionId":"0HNFUB0DAEGRC"}
[2025-09-28 13:27:53.335 +07:00 INF] Request: POST /api/auth/login {"SourceContext":"Program","RequestId":"0HNFUB0DAEGRC:00000009","RequestPath":"/api/auth/login","ConnectionId":"0HNFUB0DAEGRC"}
[2025-09-28 13:28:00.265 +07:00 INF] User staff002 (ID: 2060, Role: "Staff") logged in successfully from IP: 127.0.0.1, UserAgent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36 Edg/140.0.0.0 {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"06f43c6b-9a9d-434a-b2b1-51743479f113","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Login (EVServiceCenter.API)","RequestId":"0HNFUB0DAEGRC:00000009","RequestPath":"/api/auth/login","ConnectionId":"0HNFUB0DAEGRC"}
[2025-09-28 13:28:49.981 +07:00 INF] Request: POST /api/auth/login {"SourceContext":"Program","RequestId":"0HNFUB0DAEGRC:0000000B","RequestPath":"/api/auth/login","ConnectionId":"0HNFUB0DAEGRC"}
[2025-09-28 13:28:50.678 +07:00 WRN] Invalid password for user staff002. Failed attempts: 1 {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"06f43c6b-9a9d-434a-b2b1-51743479f113","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Login (EVServiceCenter.API)","RequestId":"0HNFUB0DAEGRC:0000000B","RequestPath":"/api/auth/login","ConnectionId":"0HNFUB0DAEGRC"}
[2025-09-28 13:29:28.002 +07:00 INF] Request: POST /api/auth/login {"SourceContext":"Program","RequestId":"0HNFUB0DAEGRC:0000000D","RequestPath":"/api/auth/login","ConnectionId":"0HNFUB0DAEGRC"}
[2025-09-28 13:29:28.656 +07:00 INF] User staff002 (ID: 2060, Role: "Staff") logged in successfully from IP: 127.0.0.1, UserAgent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36 Edg/140.0.0.0 {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"06f43c6b-9a9d-434a-b2b1-51743479f113","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Login (EVServiceCenter.API)","RequestId":"0HNFUB0DAEGRC:0000000D","RequestPath":"/api/auth/login","ConnectionId":"0HNFUB0DAEGRC"}
[2025-09-28 14:28:00.234 +07:00 INF] Now listening on: https://localhost:7077 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 14:28:00.287 +07:00 INF] Now listening on: http://localhost:5153 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 14:28:00.343 +07:00 INF] Application started. Press Ctrl+C to shut down. {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 14:28:00.347 +07:00 INF] Hosting environment: Development {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 14:28:00.350 +07:00 INF] Content root path: C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 14:28:01.031 +07:00 INF] Request: GET / {"SourceContext":"Program","RequestId":"0HNFUC26SGTGE:00000001","RequestPath":"/","ConnectionId":"0HNFUC26SGTGE"}
[2025-09-28 14:29:07.152 +07:00 INF] Request: POST /api/customer/register {"SourceContext":"Program","RequestId":"0HNFUC26SGTGE:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFUC26SGTGE"}
[2025-09-28 14:29:15.945 +07:00 WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'. {"EventId":{"Id":30004,"Name":"Microsoft.EntityFrameworkCore.Database.Transaction.SavepointsDisabledBecauseOfMARS"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Transaction","ActionId":"b4aa366d-8a62-4d32-a659-f340c7301857","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUC26SGTGE:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFUC26SGTGE"}
[2025-09-28 14:29:20.387 +07:00 INF] Email sent successfully to customerb@gmail.com with subject: Xác thực tài khoản EV Service Center {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.EmailService","ActionId":"b4aa366d-8a62-4d32-a659-f340c7301857","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUC26SGTGE:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFUC26SGTGE"}
[2025-09-28 14:29:20.401 +07:00 INF] Verification email sent to customer customerb@gmail.com for user customerb@gmail.com {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"b4aa366d-8a62-4d32-a659-f340c7301857","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUC26SGTGE:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFUC26SGTGE"}
[2025-09-28 14:29:20.407 +07:00 INF] Customer user registered successfully: customerb@gmail.com, Email: customerb@gmail.com {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"b4aa366d-8a62-4d32-a659-f340c7301857","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUC26SGTGE:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFUC26SGTGE"}
[2025-09-28 14:29:20.669 +07:00 WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'. {"EventId":{"Id":30004,"Name":"Microsoft.EntityFrameworkCore.Database.Transaction.SavepointsDisabledBecauseOfMARS"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Transaction","ActionId":"b4aa366d-8a62-4d32-a659-f340c7301857","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUC26SGTGE:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFUC26SGTGE"}
[2025-09-28 14:29:20.806 +07:00 ERR] An exception occurred in the database while saving changes for context type 'EVServiceCenter.Core.Entities.EVDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (KH2509001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ad86ff79-81ae-4151-8ab0-0e33392a2821
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken) {"EventId":{"Id":10000,"Name":"Microsoft.EntityFrameworkCore.Update.SaveChangesFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Update","ActionId":"b4aa366d-8a62-4d32-a659-f340c7301857","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUC26SGTGE:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFUC26SGTGE"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (KH2509001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ad86ff79-81ae-4151-8ab0-0e33392a2821
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
[2025-09-28 14:29:21.135 +07:00 ERR] Error creating customer with account: Nguyễn Thị B {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerAccountService","ActionId":"b4aa366d-8a62-4d32-a659-f340c7301857","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUC26SGTGE:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFUC26SGTGE"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (KH2509001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ad86ff79-81ae-4151-8ab0-0e33392a2821
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerAccountService.CreateCustomerWithAccountAsync(CreateCustomerRequestDto customerRequest, String password) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerAccountService.cs:line 107
[2025-09-28 14:29:21.521 +07:00 ERR] Error during customer self-registration: customerb@gmail.com {"SourceContext":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController","ActionId":"b4aa366d-8a62-4d32-a659-f340c7301857","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUC26SGTGE:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFUC26SGTGE"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (KH2509001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ad86ff79-81ae-4151-8ab0-0e33392a2821
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerAccountService.CreateCustomerWithAccountAsync(CreateCustomerRequestDto customerRequest, String password) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerAccountService.cs:line 107
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerAccountService.CreateCustomerWithAccountAsync(CreateCustomerRequestDto customerRequest, String password) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerAccountService.cs:line 139
   at EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer(CustomerRegistrationDto request) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API\Controllers\Customers\CustomerRegistrationController.cs:line 65
[2025-09-28 14:30:15.947 +07:00 INF] Request: POST /api/customer/register {"SourceContext":"Program","RequestId":"0HNFUC26SGTGE:0000000B","RequestPath":"/api/customer/register","ConnectionId":"0HNFUC26SGTGE"}
[2025-09-28 14:32:06.686 +07:00 WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'. {"EventId":{"Id":30004,"Name":"Microsoft.EntityFrameworkCore.Database.Transaction.SavepointsDisabledBecauseOfMARS"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Transaction","ActionId":"b4aa366d-8a62-4d32-a659-f340c7301857","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUC26SGTGE:0000000B","RequestPath":"/api/customer/register","ConnectionId":"0HNFUC26SGTGE"}
[2025-09-28 14:32:10.433 +07:00 INF] Email sent successfully to customerb@gmail.com with subject: Xác thực tài khoản EV Service Center {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.EmailService","ActionId":"b4aa366d-8a62-4d32-a659-f340c7301857","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUC26SGTGE:0000000B","RequestPath":"/api/customer/register","ConnectionId":"0HNFUC26SGTGE"}
[2025-09-28 14:32:10.489 +07:00 INF] Verification email sent to customer customerb@gmail.com for user customerb@gmail.com {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"b4aa366d-8a62-4d32-a659-f340c7301857","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUC26SGTGE:0000000B","RequestPath":"/api/customer/register","ConnectionId":"0HNFUC26SGTGE"}
[2025-09-28 14:32:10.508 +07:00 INF] Customer user registered successfully: customerb@gmail.com, Email: customerb@gmail.com {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"b4aa366d-8a62-4d32-a659-f340c7301857","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUC26SGTGE:0000000B","RequestPath":"/api/customer/register","ConnectionId":"0HNFUC26SGTGE"}
[2025-09-28 14:33:13.103 +07:00 WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'. {"EventId":{"Id":30004,"Name":"Microsoft.EntityFrameworkCore.Database.Transaction.SavepointsDisabledBecauseOfMARS"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Transaction","ActionId":"b4aa366d-8a62-4d32-a659-f340c7301857","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUC26SGTGE:0000000B","RequestPath":"/api/customer/register","ConnectionId":"0HNFUC26SGTGE"}
[2025-09-28 14:33:13.161 +07:00 ERR] An exception occurred in the database while saving changes for context type 'EVServiceCenter.Core.Entities.EVDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (KH2509001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ad86ff79-81ae-4151-8ab0-0e33392a2821
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken) {"EventId":{"Id":10000,"Name":"Microsoft.EntityFrameworkCore.Update.SaveChangesFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Update","ActionId":"b4aa366d-8a62-4d32-a659-f340c7301857","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUC26SGTGE:0000000B","RequestPath":"/api/customer/register","ConnectionId":"0HNFUC26SGTGE"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (KH2509001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ad86ff79-81ae-4151-8ab0-0e33392a2821
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
[2025-09-28 14:35:01.468 +07:00 ERR] Error creating customer with account: Nguyễn Thị B {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerAccountService","ActionId":"b4aa366d-8a62-4d32-a659-f340c7301857","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUC26SGTGE:0000000B","RequestPath":"/api/customer/register","ConnectionId":"0HNFUC26SGTGE"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (KH2509001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ad86ff79-81ae-4151-8ab0-0e33392a2821
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerAccountService.CreateCustomerWithAccountAsync(CreateCustomerRequestDto customerRequest, String password) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerAccountService.cs:line 107
[2025-09-28 14:35:01.590 +07:00 ERR] Error during customer self-registration: customerb@gmail.com {"SourceContext":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController","ActionId":"b4aa366d-8a62-4d32-a659-f340c7301857","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUC26SGTGE:0000000B","RequestPath":"/api/customer/register","ConnectionId":"0HNFUC26SGTGE"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (KH2509001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ad86ff79-81ae-4151-8ab0-0e33392a2821
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerAccountService.CreateCustomerWithAccountAsync(CreateCustomerRequestDto customerRequest, String password) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerAccountService.cs:line 107
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerAccountService.CreateCustomerWithAccountAsync(CreateCustomerRequestDto customerRequest, String password) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerAccountService.cs:line 139
   at EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer(CustomerRegistrationDto request) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API\Controllers\Customers\CustomerRegistrationController.cs:line 65
[2025-09-28 14:47:24.682 +07:00 INF] Now listening on: https://localhost:7077 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 14:47:24.732 +07:00 INF] Now listening on: http://localhost:5153 {"EventId":{"Id":14,"Name":"ListeningOnAddress"},"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 14:47:24.809 +07:00 INF] Application started. Press Ctrl+C to shut down. {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 14:47:24.814 +07:00 INF] Hosting environment: Development {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 14:47:24.821 +07:00 INF] Content root path: C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API {"SourceContext":"Microsoft.Hosting.Lifetime"}
[2025-09-28 14:47:25.227 +07:00 INF] Request: GET / {"SourceContext":"Program","RequestId":"0HNFUCD1RLJ0H:00000001","RequestPath":"/","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:47:47.765 +07:00 INF] Request: POST /api/customer/register {"SourceContext":"Program","RequestId":"0HNFUCD1RLJ0H:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:48:00.292 +07:00 WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'. {"EventId":{"Id":30004,"Name":"Microsoft.EntityFrameworkCore.Database.Transaction.SavepointsDisabledBecauseOfMARS"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Transaction","ActionId":"fc6f5fef-efef-4056-838f-9466cc975437","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUCD1RLJ0H:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:48:06.237 +07:00 INF] Email sent successfully to customerb@gmail.com with subject: Xác thực tài khoản EV Service Center {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.EmailService","ActionId":"fc6f5fef-efef-4056-838f-9466cc975437","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUCD1RLJ0H:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:48:06.264 +07:00 INF] Verification email sent to customer customerb@gmail.com for user customerb@gmail.com {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"fc6f5fef-efef-4056-838f-9466cc975437","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUCD1RLJ0H:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:48:06.287 +07:00 INF] Customer user registered successfully: customerb@gmail.com, Email: customerb@gmail.com {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"fc6f5fef-efef-4056-838f-9466cc975437","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUCD1RLJ0H:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:48:06.408 +07:00 WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'. {"EventId":{"Id":30004,"Name":"Microsoft.EntityFrameworkCore.Database.Transaction.SavepointsDisabledBecauseOfMARS"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Transaction","ActionId":"fc6f5fef-efef-4056-838f-9466cc975437","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUCD1RLJ0H:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:48:06.607 +07:00 INF] Created customer with account: CUS000001 - Nguyễn Thị B - UserID: 2063 {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerAccountService","ActionId":"fc6f5fef-efef-4056-838f-9466cc975437","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUCD1RLJ0H:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:48:06.625 +07:00 INF] Customer self-registered: CUS000001 - Nguyễn Thị B - customerb@gmail.com {"SourceContext":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController","ActionId":"fc6f5fef-efef-4056-838f-9466cc975437","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUCD1RLJ0H:00000009","RequestPath":"/api/customer/register","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:51:04.321 +07:00 INF] Request: POST /api/auth/login {"SourceContext":"Program","RequestId":"0HNFUCD1RLJ0H:0000000B","RequestPath":"/api/auth/login","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:51:04.726 +07:00 WRN] Login failed: Username customer001 not found {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"3ea90549-cef0-4ead-b53d-519445058cf6","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Login (EVServiceCenter.API)","RequestId":"0HNFUCD1RLJ0H:0000000B","RequestPath":"/api/auth/login","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:52:23.274 +07:00 INF] Request: POST /api/auth/login {"SourceContext":"Program","RequestId":"0HNFUCD1RLJ0H:0000000D","RequestPath":"/api/auth/login","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:52:24.046 +07:00 WRN] Login blocked: Email not verified for customerb@gmail.com {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"3ea90549-cef0-4ead-b53d-519445058cf6","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Login (EVServiceCenter.API)","RequestId":"0HNFUCD1RLJ0H:0000000D","RequestPath":"/api/auth/login","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:54:22.585 +07:00 INF] Request: POST /api/auth/login {"SourceContext":"Program","RequestId":"0HNFUCD1RLJ0H:0000000F","RequestPath":"/api/auth/login","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:54:23.210 +07:00 INF] User customerb@gmail.com (ID: 2063, Role: "Customer") logged in successfully from IP: 127.0.0.1, UserAgent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36 Edg/140.0.0.0 {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"3ea90549-cef0-4ead-b53d-519445058cf6","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Login (EVServiceCenter.API)","RequestId":"0HNFUCD1RLJ0H:0000000F","RequestPath":"/api/auth/login","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:55:04.423 +07:00 INF] Request: GET /api/auth/profile {"SourceContext":"Program","RequestId":"0HNFUCD1RLJ0H:00000011","RequestPath":"/api/auth/profile","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:55:15.899 +07:00 INF] Request: GET /api/customer/profile/me {"SourceContext":"Program","RequestId":"0HNFUCD1RLJ0H:00000013","RequestPath":"/api/customer/profile/me","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:55:38.476 +07:00 INF] Request: GET /api/customers {"SourceContext":"Program","RequestId":"0HNFUCD1RLJ0H:00000015","RequestPath":"/api/customers","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:56:12.531 +07:00 INF] Request: GET /api/customers/1 {"SourceContext":"Program","RequestId":"0HNFUCD1RLJ0H:00000017","RequestPath":"/api/customers/1","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:57:24.946 +07:00 INF] Request: POST /api/auth/login {"SourceContext":"Program","RequestId":"0HNFUCD1RLJ0H:00000019","RequestPath":"/api/auth/login","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:57:25.360 +07:00 INF] User NghiaPham (ID: 8, Role: "Admin") logged in successfully from IP: 127.0.0.1, UserAgent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36 Edg/140.0.0.0 {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"3ea90549-cef0-4ead-b53d-519445058cf6","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Login (EVServiceCenter.API)","RequestId":"0HNFUCD1RLJ0H:00000019","RequestPath":"/api/auth/login","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:57:29.531 +07:00 INF] Email sent successfully to admin01@evservice.com with subject: Thông báo đăng nhập {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.EmailService","ActionId":"3ea90549-cef0-4ead-b53d-519445058cf6","ActionName":"EVServiceCenter.API.Controllers.Auth.AuthController.Login (EVServiceCenter.API)","RequestId":"0HNFUCD1RLJ0H:00000019","RequestPath":"/api/auth/login","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:57:50.379 +07:00 INF] Request: GET /api/auth/profile {"SourceContext":"Program","RequestId":"0HNFUCD1RLJ0H:0000001B","RequestPath":"/api/auth/profile","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:57:55.790 +07:00 INF] Request: GET /api/customer/profile/me {"SourceContext":"Program","RequestId":"0HNFUCD1RLJ0H:0000001D","RequestPath":"/api/customer/profile/me","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:58:15.430 +07:00 INF] Request: GET /api/customers {"SourceContext":"Program","RequestId":"0HNFUCD1RLJ0H:0000001F","RequestPath":"/api/customers","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:59:15.315 +07:00 INF] Request: GET /api/customers/1 {"SourceContext":"Program","RequestId":"0HNFUCD1RLJ0H:00000021","RequestPath":"/api/customers/1","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:59:26.280 +07:00 INF] Request: GET /api/customers/2 {"SourceContext":"Program","RequestId":"0HNFUCD1RLJ0H:00000023","RequestPath":"/api/customers/2","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 14:59:55.632 +07:00 INF] Request: GET /api/customers/active {"SourceContext":"Program","RequestId":"0HNFUCD1RLJ0H:00000025","RequestPath":"/api/customers/active","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 15:00:13.998 +07:00 INF] Request: GET /api/customers/statistics {"SourceContext":"Program","RequestId":"0HNFUCD1RLJ0H:00000027","RequestPath":"/api/customers/statistics","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 15:00:30.881 +07:00 INF] Request: GET /api/customer-types {"SourceContext":"Program","RequestId":"0HNFUCD1RLJ0H:00000029","RequestPath":"/api/customer-types","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 15:01:06.494 +07:00 INF] Request: GET /api/customer-types/statistics {"SourceContext":"Program","RequestId":"0HNFUCD1RLJ0H:0000002B","RequestPath":"/api/customer-types/statistics","ConnectionId":"0HNFUCD1RLJ0H"}
[2025-09-28 15:02:57.397 +07:00 INF] Request: POST /api/customer/register {"SourceContext":"Program","RequestId":"0HNFUCD1RLJ0I:00000001","RequestPath":"/api/customer/register","ConnectionId":"0HNFUCD1RLJ0I"}
[2025-09-28 15:03:00.807 +07:00 WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'. {"EventId":{"Id":30004,"Name":"Microsoft.EntityFrameworkCore.Database.Transaction.SavepointsDisabledBecauseOfMARS"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Transaction","ActionId":"fc6f5fef-efef-4056-838f-9466cc975437","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUCD1RLJ0I:00000001","RequestPath":"/api/customer/register","ConnectionId":"0HNFUCD1RLJ0I"}
[2025-09-28 15:03:05.186 +07:00 INF] Email sent successfully to nghiadaucau1@gmail.com with subject: Xác thực tài khoản EV Service Center {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.EmailService","ActionId":"fc6f5fef-efef-4056-838f-9466cc975437","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUCD1RLJ0I:00000001","RequestPath":"/api/customer/register","ConnectionId":"0HNFUCD1RLJ0I"}
[2025-09-28 15:03:05.205 +07:00 INF] Verification email sent to customer nghiadaucau1@gmail.com for user nghiadaucau1@gmail.com {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"fc6f5fef-efef-4056-838f-9466cc975437","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUCD1RLJ0I:00000001","RequestPath":"/api/customer/register","ConnectionId":"0HNFUCD1RLJ0I"}
[2025-09-28 15:03:05.214 +07:00 INF] Customer user registered successfully: nghiadaucau1@gmail.com, Email: nghiadaucau1@gmail.com {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"fc6f5fef-efef-4056-838f-9466cc975437","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUCD1RLJ0I:00000001","RequestPath":"/api/customer/register","ConnectionId":"0HNFUCD1RLJ0I"}
[2025-09-28 15:03:05.251 +07:00 WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'. {"EventId":{"Id":30004,"Name":"Microsoft.EntityFrameworkCore.Database.Transaction.SavepointsDisabledBecauseOfMARS"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Transaction","ActionId":"fc6f5fef-efef-4056-838f-9466cc975437","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUCD1RLJ0I:00000001","RequestPath":"/api/customer/register","ConnectionId":"0HNFUCD1RLJ0I"}
[2025-09-28 15:03:05.294 +07:00 ERR] An exception occurred in the database while saving changes for context type 'EVServiceCenter.Core.Entities.EVDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (CUS000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:eae11244-5b94-48d4-b9c7-601c163f49a3
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken) {"EventId":{"Id":10000,"Name":"Microsoft.EntityFrameworkCore.Update.SaveChangesFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Update","ActionId":"fc6f5fef-efef-4056-838f-9466cc975437","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUCD1RLJ0I:00000001","RequestPath":"/api/customer/register","ConnectionId":"0HNFUCD1RLJ0I"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (CUS000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:eae11244-5b94-48d4-b9c7-601c163f49a3
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
[2025-09-28 15:03:05.494 +07:00 ERR] Error creating customer with account: Pham Nhat Nghia {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerAccountService","ActionId":"fc6f5fef-efef-4056-838f-9466cc975437","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUCD1RLJ0I:00000001","RequestPath":"/api/customer/register","ConnectionId":"0HNFUCD1RLJ0I"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (CUS000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:eae11244-5b94-48d4-b9c7-601c163f49a3
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerAccountService.CreateCustomerWithAccountAsync(CreateCustomerRequestDto customerRequest, String password) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerAccountService.cs:line 107
[2025-09-28 15:03:05.782 +07:00 ERR] Error during customer self-registration: nghiadaucau1@gmail.com {"SourceContext":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController","ActionId":"fc6f5fef-efef-4056-838f-9466cc975437","ActionName":"EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer (EVServiceCenter.API)","RequestId":"0HNFUCD1RLJ0I:00000001","RequestPath":"/api/customer/register","ConnectionId":"0HNFUCD1RLJ0I"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__Customer__0667852144B528A0'. Cannot insert duplicate key in object 'dbo.Customers'. The duplicate key value is (CUS000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:eae11244-5b94-48d4-b9c7-601c163f49a3
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerAccountService.CreateCustomerWithAccountAsync(CreateCustomerRequestDto customerRequest, String password) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerAccountService.cs:line 107
   at EVServiceCenter.Infrastructure.Domains.Customers.Services.CustomerAccountService.CreateCustomerWithAccountAsync(CreateCustomerRequestDto customerRequest, String password) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.Infrastructure\Domains\Customers\Services\CustomerAccountService.cs:line 139
   at EVServiceCenter.API.Controllers.Customers.CustomerRegistrationController.RegisterCustomer(CustomerRegistrationDto request) in C:\Users\ADMIN\Desktop\EVServiceCenter-BackupV2-Done-main\EVServiceCenter-BackupV2-Done-main\EVServiceCenter.API\Controllers\Customers\CustomerRegistrationController.cs:line 65
[2025-09-28 15:09:39.062 +07:00 INF] Request: POST /api/verification/verify-email {"SourceContext":"Program","RequestId":"0HNFUCD1RLJ0I:00000003","RequestPath":"/api/verification/verify-email","ConnectionId":"0HNFUCD1RLJ0I"}
[2025-09-28 15:09:39.226 +07:00 WRN] Invalid email verification attempt for: nghiadaucau1@gmail.com {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"6e952111-d327-474a-be73-63bf5eb077fb","ActionName":"EVServiceCenter.API.Controllers.Auth.VerificationController.VerifyEmail (EVServiceCenter.API)","RequestId":"0HNFUCD1RLJ0I:00000003","RequestPath":"/api/verification/verify-email","ConnectionId":"0HNFUCD1RLJ0I"}
[2025-09-28 15:10:05.263 +07:00 INF] Request: POST /api/verification/verify-email {"SourceContext":"Program","RequestId":"0HNFUCD1RLJ0I:00000005","RequestPath":"/api/verification/verify-email","ConnectionId":"0HNFUCD1RLJ0I"}
[2025-09-28 15:10:05.280 +07:00 WRN] Invalid email verification attempt for: nghiadaucau1@gmail.com {"SourceContext":"EVServiceCenter.Infrastructure.Domains.Identity.Services.UserService","ActionId":"6e952111-d327-474a-be73-63bf5eb077fb","ActionName":"EVServiceCenter.API.Controllers.Auth.VerificationController.VerifyEmail (EVServiceCenter.API)","RequestId":"0HNFUCD1RLJ0I:00000005","RequestPath":"/api/verification/verify-email","ConnectionId":"0HNFUCD1RLJ0I"}
